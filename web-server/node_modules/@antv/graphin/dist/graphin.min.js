!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("G6"),require("React")):"function"==typeof define&&define.amd?define(["G6","React"],e):"object"==typeof exports?exports.Graphin=e(require("G6"),require("React")):t.Graphin=e(t.G6,t.React)}(self,(function(t,e){return(()=>{"use strict";var i={808:(t,e,i)=>{i.d(e,{Z:()=>Xt}),t=i.hmd(t);var n="__lodash_hash_undefined__",o=9007199254740991,s="[object Arguments]",r="[object Boolean]",a="[object Date]",l="[object Function]",c="[object GeneratorFunction]",d="[object Map]",h="[object Number]",u="[object Object]",p="[object Promise]",g="[object RegExp]",f="[object Set]",y="[object String]",m="[object Symbol]",v="[object WeakMap]",b="[object ArrayBuffer]",x="[object DataView]",O="[object Float32Array]",w="[object Float64Array]",j="[object Int8Array]",S="[object Int16Array]",E="[object Int32Array]",_="[object Uint8Array]",C="[object Uint8ClampedArray]",N="[object Uint16Array]",k="[object Uint32Array]",M=/\w*$/,P=/^\[object .+?Constructor\]$/,D=/^(?:0|[1-9]\d*)$/,L={};L[s]=L["[object Array]"]=L[b]=L[x]=L[r]=L[a]=L[O]=L[w]=L[j]=L[S]=L[E]=L[d]=L[h]=L[u]=L[g]=L[f]=L[y]=L[m]=L[_]=L[C]=L[N]=L[k]=!0,L["[object Error]"]=L[l]=L[v]=!1;var T="object"==typeof i.g&&i.g&&i.g.Object===Object&&i.g,A="object"==typeof self&&self&&self.Object===Object&&self,I=T||A||Function("return this")(),$="object"==typeof exports&&exports&&!exports.nodeType&&exports,z=$&&t&&!t.nodeType&&t,F=z&&z.exports===$;function B(t,e){return t.set(e[0],e[1]),t}function R(t,e){return t.add(e),t}function W(t,e,i,n){var o=-1,s=t?t.length:0;for(n&&s&&(i=t[++o]);++o<s;)i=e(i,t[o],o,t);return i}function G(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function Z(t){var e=-1,i=Array(t.size);return t.forEach((function(t,n){i[++e]=[n,t]})),i}function q(t,e){return function(i){return t(e(i))}}function V(t){var e=-1,i=Array(t.size);return t.forEach((function(t){i[++e]=t})),i}var H,U=Array.prototype,X=Function.prototype,Y=Object.prototype,K=I["__core-js_shared__"],Q=(H=/[^.]+$/.exec(K&&K.keys&&K.keys.IE_PROTO||""))?"Symbol(src)_1."+H:"",J=X.toString,tt=Y.hasOwnProperty,et=Y.toString,it=RegExp("^"+J.call(tt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),nt=F?I.Buffer:void 0,ot=I.Symbol,st=I.Uint8Array,rt=q(Object.getPrototypeOf,Object),at=Object.create,lt=Y.propertyIsEnumerable,ct=U.splice,dt=Object.getOwnPropertySymbols,ht=nt?nt.isBuffer:void 0,ut=q(Object.keys,Object),pt=It(I,"DataView"),gt=It(I,"Map"),ft=It(I,"Promise"),yt=It(I,"Set"),mt=It(I,"WeakMap"),vt=It(Object,"create"),bt=Rt(pt),xt=Rt(gt),Ot=Rt(ft),wt=Rt(yt),jt=Rt(mt),St=ot?ot.prototype:void 0,Et=St?St.valueOf:void 0;function _t(t){var e=-1,i=t?t.length:0;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function Ct(t){var e=-1,i=t?t.length:0;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function Nt(t){var e=-1,i=t?t.length:0;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function kt(t){this.__data__=new Ct(t)}function Mt(t,e,i){var n=t[e];tt.call(t,e)&&Wt(n,i)&&(void 0!==i||e in t)||(t[e]=i)}function Pt(t,e){for(var i=t.length;i--;)if(Wt(t[i][0],e))return i;return-1}function Dt(t,e,i,n,o,p,v){var P;if(n&&(P=p?n(t,o,p,v):n(t)),void 0!==P)return P;if(!Ht(t))return t;var D=Gt(t);if(D){if(P=function(t){var e=t.length,i=t.constructor(e);return e&&"string"==typeof t[0]&&tt.call(t,"index")&&(i.index=t.index,i.input=t.input),i}(t),!e)return function(t,e){var i=-1,n=t.length;for(e||(e=Array(n));++i<n;)e[i]=t[i];return e}(t,P)}else{var T=zt(t),A=T==l||T==c;if(qt(t))return function(t,e){if(e)return t.slice();var i=new t.constructor(t.length);return t.copy(i),i}(t,e);if(T==u||T==s||A&&!p){if(G(t))return p?t:{};if(P=function(t){return"function"!=typeof t.constructor||Bt(t)?{}:Ht(e=rt(t))?at(e):{};var e}(A?{}:t),!e)return function(t,e){return Tt(t,$t(t),e)}(t,function(t,e){return t&&Tt(e,Ut(e),t)}(P,t))}else{if(!L[T])return p?t:{};P=function(t,e,i,n){var o,s=t.constructor;switch(e){case b:return Lt(t);case r:case a:return new s(+t);case x:return function(t,e){var i=e?Lt(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)}(t,n);case O:case w:case j:case S:case E:case _:case C:case N:case k:return function(t,e){var i=e?Lt(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}(t,n);case d:return function(t,e,i){return W(e?i(Z(t),!0):Z(t),B,new t.constructor)}(t,n,i);case h:case y:return new s(t);case g:return function(t){var e=new t.constructor(t.source,M.exec(t));return e.lastIndex=t.lastIndex,e}(t);case f:return function(t,e,i){return W(e?i(V(t),!0):V(t),R,new t.constructor)}(t,n,i);case m:return o=t,Et?Object(Et.call(o)):{}}}(t,T,Dt,e)}}v||(v=new kt);var I=v.get(t);if(I)return I;if(v.set(t,P),!D)var $=i?function(t){return function(t,e,i){var n=e(t);return Gt(t)?n:function(t,e){for(var i=-1,n=e.length,o=t.length;++i<n;)t[o+i]=e[i];return t}(n,i(t))}(t,Ut,$t)}(t):Ut(t);return function(t,e){for(var i=-1,n=t?t.length:0;++i<n&&!1!==e(t[i],i););}($||t,(function(o,s){$&&(o=t[s=o]),Mt(P,s,Dt(o,e,i,n,s,t,v))})),P}function Lt(t){var e=new t.constructor(t.byteLength);return new st(e).set(new st(t)),e}function Tt(t,e,i,n){i||(i={});for(var o=-1,s=e.length;++o<s;){var r=e[o],a=n?n(i[r],t[r],r,i,t):void 0;Mt(i,r,void 0===a?t[r]:a)}return i}function At(t,e){var i,n,o=t.__data__;return("string"==(n=typeof(i=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==i:null===i)?o["string"==typeof e?"string":"hash"]:o.map}function It(t,e){var i=function(t,e){return null==t?void 0:t[e]}(t,e);return function(t){return!(!Ht(t)||(e=t,Q&&Q in e))&&(Vt(t)||G(t)?it:P).test(Rt(t));var e}(i)?i:void 0}_t.prototype.clear=function(){this.__data__=vt?vt(null):{}},_t.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},_t.prototype.get=function(t){var e=this.__data__;if(vt){var i=e[t];return i===n?void 0:i}return tt.call(e,t)?e[t]:void 0},_t.prototype.has=function(t){var e=this.__data__;return vt?void 0!==e[t]:tt.call(e,t)},_t.prototype.set=function(t,e){return this.__data__[t]=vt&&void 0===e?n:e,this},Ct.prototype.clear=function(){this.__data__=[]},Ct.prototype.delete=function(t){var e=this.__data__,i=Pt(e,t);return!(i<0||(i==e.length-1?e.pop():ct.call(e,i,1),0))},Ct.prototype.get=function(t){var e=this.__data__,i=Pt(e,t);return i<0?void 0:e[i][1]},Ct.prototype.has=function(t){return Pt(this.__data__,t)>-1},Ct.prototype.set=function(t,e){var i=this.__data__,n=Pt(i,t);return n<0?i.push([t,e]):i[n][1]=e,this},Nt.prototype.clear=function(){this.__data__={hash:new _t,map:new(gt||Ct),string:new _t}},Nt.prototype.delete=function(t){return At(this,t).delete(t)},Nt.prototype.get=function(t){return At(this,t).get(t)},Nt.prototype.has=function(t){return At(this,t).has(t)},Nt.prototype.set=function(t,e){return At(this,t).set(t,e),this},kt.prototype.clear=function(){this.__data__=new Ct},kt.prototype.delete=function(t){return this.__data__.delete(t)},kt.prototype.get=function(t){return this.__data__.get(t)},kt.prototype.has=function(t){return this.__data__.has(t)},kt.prototype.set=function(t,e){var i=this.__data__;if(i instanceof Ct){var n=i.__data__;if(!gt||n.length<199)return n.push([t,e]),this;i=this.__data__=new Nt(n)}return i.set(t,e),this};var $t=dt?q(dt,Object):function(){return[]},zt=function(t){return et.call(t)};function Ft(t,e){return!!(e=null==e?o:e)&&("number"==typeof t||D.test(t))&&t>-1&&t%1==0&&t<e}function Bt(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Y)}function Rt(t){if(null!=t){try{return J.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Wt(t,e){return t===e||t!=t&&e!=e}(pt&&zt(new pt(new ArrayBuffer(1)))!=x||gt&&zt(new gt)!=d||ft&&zt(ft.resolve())!=p||yt&&zt(new yt)!=f||mt&&zt(new mt)!=v)&&(zt=function(t){var e=et.call(t),i=e==u?t.constructor:void 0,n=i?Rt(i):void 0;if(n)switch(n){case bt:return x;case xt:return d;case Ot:return p;case wt:return f;case jt:return v}return e});var Gt=Array.isArray;function Zt(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=o}(t.length)&&!Vt(t)}var qt=ht||function(){return!1};function Vt(t){var e=Ht(t)?et.call(t):"";return e==l||e==c}function Ht(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function Ut(t){return Zt(t)?function(t,e){var i=Gt(t)||function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&Zt(t)}(t)&&tt.call(t,"callee")&&(!lt.call(t,"callee")||et.call(t)==s)}(t)?function(t,e){for(var i=-1,n=Array(t);++i<t;)n[i]=e(i);return n}(t.length,String):[],n=i.length,o=!!n;for(var r in t)!e&&!tt.call(t,r)||o&&("length"==r||Ft(r,n))||i.push(r);return i}(t):function(t){if(!Bt(t))return ut(t);var e=[];for(var i in Object(t))tt.call(t,i)&&"constructor"!=i&&e.push(i);return e}(t)}const Xt=function(t){return Dt(t,!0,!0)}},835:e=>{e.exports=t},24:t=>{t.exports=e}},n={};function o(t){var e=n[t];if(void 0!==e)return e.exports;var s=n[t]={id:t,loaded:!1,exports:{}};return i[t](s,s.exports,o),s.loaded=!0,s.exports}o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var i in e)o.o(e,i)&&!o.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.hmd=t=>((t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t),o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var s={};return(()=>{o.r(s),o.d(s,{Behaviors:()=>P,Components:()=>St,G6:()=>I(),GraphinContext:()=>r,Utils:()=>dt,default:()=>We,registerFontFamily:()=>Re});var t={};o.r(t),o.d(t,{handleAutoZoom:()=>kt,handleChangeZoom:()=>Ct,handleRealZoom:()=>Nt,handleZoomIn:()=>_t,handleZoomOut:()=>Et});var e={};o.r(e),o.d(e,{focusNodeById:()=>Pt,highlightNodeById:()=>Mt});var i=o(24),n=o.n(i);const r=n().createContext({graph:{},apis:{},theme:{},layout:{}});const a=t=>{const{type:e,defaultConfig:i,userProps:o,mode:s="default"}=t,{graph:a}=n().useContext(r),{disabled:l}=o,c=function(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(i[n[o]]=t[n[o]])}return i}(o,["disabled"]);n().useEffect((()=>{if(a.removeBehaviors(e,s),!l)return a.addBehaviors(Object.assign(Object.assign({type:e},i),c),s),()=>{a.destroyed||a.removeBehaviors(e,s)}}),[])},l={disabled:!1,trigger:"mouseenter",activeState:"active",inactiveState:"inactive",resetSelected:!1},c={disabled:!1,brushStyle:{fill:"#EEF6FF",fillOpacity:.4,stroke:"#DDEEFE",lineWidth:1},onSelect:()=>{},onDeselect:()=>{},selectedState:"selected",trigger:"shift",includeEdges:!0,includeCombos:!1},d={disabled:!1,multiple:!0,trigger:"shift",selectedState:"selected",selectNode:!0,selectEdge:!1,selectCombo:!0},h={direction:"both",enableOptimize:!1,scalableRange:0,shouldBegin:()=>!0,disabled:!1},u={disabled:!1,enableDelegate:!1,delegateStyle:{},onlyChangeComboSize:!1,activeState:"",selectedState:"selected"},p={disabled:!1,updateEdge:!0,delegateStyle:{},enableDelegate:!1,onlyChangeComboSize:!1,comboActiveState:"",selectedState:"selected"},g=t=>{const{graph:e,layout:o,dragNodes:s,updateContext:a}=n().useContext(r),{autoPin:l,pinAction:c,dragNodeMass:d=1e10}=t,{instance:h}=o;return(0,i.useEffect)((()=>{var t;const{simulation:i,type:n}=h||{type:null===(t=e.get("layout"))||void 0===t?void 0:t.type},o=()=>{var t;i?i.stop():((null===(t=e.get("layoutController"))||void 0===t?void 0:t.layoutMethods)||[]).forEach((t=>{var e;return null===(e=t.stop)||void 0===e?void 0:e.call(t)}))},r=t=>{if(("graphin-force"===n||"force2"===n)&&t.item){const i=t.item.get("model");i.layout=Object.assign(Object.assign({},i.layout),{force:{mass:l?d:null}});const n=[];e.getNodes().forEach((t=>{if(t.hasState("selected")){const e=t.get("model");e.layout||(e.layout={}),e.layout.force={mass:l?d:null},n.push(e)}}));let o=s.concat([i]);n.length>1&&(o=o.concat(n)),a({dragNodes:o})}};return e.on("node:dragstart",o),e.on("node:dragend",r),()=>{e.off("node:dragstart",o),e.off("node:dragend",r)}}),[e,l,h,s,a]),(0,i.useEffect)((()=>{const{id:t,pinned:i}=c||{};if(!t)return;let n=s;if(i){const i=e.findById(t);if(!i)return;const o=i.get("model");o.layout||(o.layout={}),o.layout.force={mass:l?d:null},n.push(o)}else n=s.filter((e=>e.id!==t));a({dragNodes:n})}),[c]),null};g.defaultProps={autoPin:!1,dragNodeMass:1e10,pinAction:void 0};const f=g,y={disabled:!1,delegateStyle:{fill:"#EEF6FF",fillOpacity:.4,stroke:"#DDEEFE",lineWidth:1},onSelect:()=>{},onDeselect:()=>{},selectedState:"selected",trigger:"shift",includeEdges:!0};var m={}.toString;const v=function(t,e){return m.call(t)==="[object "+e+"]"},b=function(t){return v(t,"Function")},x=function(t){return Array.isArray?Array.isArray(t):v(t,"Array")};Object.keys;const O=function(t){if(!function(t){return"object"==typeof t&&null!==t}(t)||!v(t,"Object"))return!1;if(null===Object.getPrototypeOf(t))return!0;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e};var w=Array.prototype;w.splice,w.indexOf,Array.prototype.splice,Object.prototype.hasOwnProperty;const j=function(t){return v(t,"Number")};Number.isInteger&&Number.isInteger,Math.PI,parseInt,Math.PI;const S=Object.values?function(t){return Object.values(t)}:function(t){var e=[];return function(t,e){var i,n;if(t)if(x(t))for(var o=0,s=t.length;o<s&&!1!==e(t[o],o);o++);else if(n=typeof(i=t),null!==i&&"object"===n||"function"===n)for(var r in t)if(t.hasOwnProperty(r)&&!1===e(t[r],r))break}(t,(function(i,n){b(t)&&"prototype"===n||e.push(i)})),e};Object.prototype;const E=function(t,e,i){var n;return function(){var o=this,s=arguments,r=function(){n=null,i||t.apply(o,s)},a=i&&!n;clearTimeout(n),n=setTimeout(r,e),a&&t.apply(o,s)}};function _(t,e,i,n){for(var o in i=i||0,n=n||5,e)if(e.hasOwnProperty(o)){var s=e[o];null!==s&&O(s)?(O(t[o])||(t[o]={}),i<n?_(t[o],s,i+1,n):t[o]=e[o]):x(s)?(t[o]=[],t[o]=t[o].concat(s)):void 0!==s&&(t[o]=s)}}const C=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];for(var n=0;n<e.length;n+=1)_(t,e[n]);return t};var N;Object.prototype.hasOwnProperty,Object.prototype.hasOwnProperty,Object.create,Object.create,function(t,e){if(!b(t))throw new TypeError("Expected a function");var i=function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];var s=e?e.apply(this,n):n[0],r=i.cache;if(r.has(s))return r.get(s);var a=t.apply(this,n);return r.set(s,a),a};i.cache=new Map}((function(t,e){void 0===e&&(e={});var i,n=e.fontSize,o=e.fontFamily,s=e.fontWeight,r=e.fontStyle,a=e.fontVariant;return N||(N=document.createElement("canvas").getContext("2d")),N.font=[r,a,s,n+"px",o].join(" "),N.measureText((i=t,v(i,"String")?t:"")).width}),(function(t,e){return void 0===e&&(e={}),function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<i;e++)for(var s=arguments[e],r=0,a=s.length;r<a;r++,o++)n[o]=s[r];return n}([t],S(e)).join("")})),function(){function t(){this.map={}}t.prototype.has=function(t){return void 0!==this.map[t]},t.prototype.get=function(t,e){var i=this.map[t];return void 0===i?e:i},t.prototype.set=function(t,e){this.map[t]=e},t.prototype.clear=function(){this.map={}},t.prototype.delete=function(t){delete this.map[t]},t.prototype.size=function(){return Object.keys(this.map).length}}();const k={trigger:"click"},M={sensitivity:2,minZoom:void 0,maxZoom:void 0,enableOptimize:!1,optimizeZoom:.1,fixSelectedItems:{fixAll:!1,fixLineWidth:!1,fixLabel:!1,fixState:"selected"},disabled:!1,animate:!1,animateCfg:{duration:500}},P={DragCanvas:t=>(a({type:"drag-canvas",userProps:t,defaultConfig:h}),null),ZoomCanvas:t=>(a({type:"zoom-canvas",userProps:t,defaultConfig:M}),null),ClickSelect:t=>(a({type:"click-select",userProps:t,defaultConfig:d}),null),BrushSelect:t=>(a({type:"brush-select",userProps:t,defaultConfig:c}),null),DragNode:t=>(a({type:"drag-node",userProps:t,defaultConfig:p}),null),ResizeCanvas:t=>{const{graphDOM:e}=t,n=i.useContext(r);return i.useEffect((()=>{const{graph:t}=n,i=E((()=>{const{clientWidth:i,clientHeight:n}=e;t.set("width",i),t.set("height",n);const o=t.get("canvas");o&&(o.changeSize(i,n),t.autoPaint())}),200);return window.addEventListener("resize",i,!1),()=>{window.removeEventListener("resize",i,!1)}}),[]),null},LassoSelect:t=>(a({type:"lasso-select",userProps:t,defaultConfig:y}),null),DragCombo:t=>(a({type:"drag-combo",userProps:t,defaultConfig:u}),null),ActivateRelations:t=>(a({type:"activate-relations",userProps:t,defaultConfig:l}),null),TreeCollapse:t=>{const{onChange:e}=t,n=function(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(i[n[o]]=t[n[o]])}return i}(t,["onChange"]),{graph:o}=i.useContext(r);return a({defaultConfig:k,userProps:n,type:"collapse-expand"}),i.useEffect((()=>{const t=t=>{const{item:i,collapsed:n}=t;i.get("model").collapsed=n,e&&e(i,n)};return o.on("itemcollapsed",t),()=>{o.off("itemcollapsed",t)}}),[]),null},FitView:t=>{const{padding:e,isBindLayoutChange:o}=t,{graph:s}=n().useContext(r);return(0,i.useEffect)((()=>{const t=()=>{s.fitView(e)};return t(),o&&s.on("afterlayout",t),()=>{o&&s.off("afterlayout",t)}}),[]),null},FontPaint:()=>{const{graph:t}=n().useContext(r);return n().useEffect((()=>{const e=setTimeout((()=>{t.getNodes().forEach((e=>{t.setItemState(e,"normal",!0)})),t.paint()}),1600);return()=>{clearTimeout(e)}}),[]),null},DragNodeWithForce:f,Hoverable:t=>{const e=i.useContext(r),{bindType:n="node",disabled:o}=t,{graph:s}=e;return i.useEffect((()=>{if(o)return;const t=t=>{s.setItemState(t.item,"hover",!0)},e=t=>{s.setItemState(t.item,"hover",!1)},i=t=>{s.setItemState(t.item,"hover",!0)},r=t=>{s.setItemState(t.item,"hover",!1)};return"node"===n&&(s.on("node:mouseenter",t),s.on("node:mouseleave",e)),"edge"===n&&(s.on("edge:mouseenter",i),s.on("edge:mouseleave",r)),()=>{"node"===n&&(s.off("node:mouseenter",t),s.off("node:mouseleave",e)),"edge"===n&&(s.off("edge:mouseenter",i),s.off("edge:mouseleave",r))}}),[s,o]),null}},D=t=>{const{bindType:e="node",container:o}=t,{graph:s}=n().useContext(r),[a,l]=n().useState({visible:!1,x:0,y:0,item:null,selectedItems:[]}),c=t=>{t.preventDefault(),t.stopPropagation();const i=s.get("width"),n=s.get("height");if(!o.current)return;const r=o.current.getBoundingClientRect(),a=s.get("offsetX")||0,c=s.get("offsetY")||0,d=s.getContainer().offsetTop,h=s.getContainer().offsetLeft;let u=t.canvasX+h+a,p=t.canvasY+d+c;if(u+r.width>i&&(u=t.canvasX-r.width-a+h),p+r.height>n&&(p=t.canvasY-r.height-c+d),"node"===e){const{x:e,y:i}=t.item&&t.item.getModel(),n=s.getCanvasByPoint(e,i),o=t.canvasX-n.x,r=t.canvasY-n.y;u-=o,p-=r}l((e=>Object.assign(Object.assign({},e),{visible:!0,x:u,y:p,item:t.item})))},d=()=>{l((t=>t.visible?Object.assign(Object.assign({},t),{visible:!1,x:0,y:0}):t))};(0,i.useEffect)((()=>{const t=t=>{l((e=>Object.assign(Object.assign({},e),{selectedItems:t.selectedItems})))};return s.on(`${e}:contextmenu`,c),s.on("canvas:click",d),s.on("canvas:drag",d),s.on("wheelzoom",d),"canvas"===e&&s.on("nodeselectchange",t),()=>{s.off(`${e}:contextmenu`,c),s.off("canvas:click",d),s.off("canvas:drag",d),s.off("wheelzoom",d),s.off("nodeselectchange",t)}}),[s,e]);const{x:h,y:u,visible:p,item:g,selectedItems:f}=a;return{oneShow:c,onClose:d,item:g,selectedItems:f,visible:p,x:h,y:u}},L={width:"120px",boxShadow:"0 4px 12px rgb(0 0 0 / 15%)"},T=n().createRef();var A=o(835),I=o.n(A);const $={r:249,scaleRByWheel:!0,minR:100,maxR:500,delegateStyle:{stroke:"#000",strokeOpacity:.8,lineWidth:2,fillOpacity:.1,fill:"#ccc"},showLabel:!1};var z=function(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(i[n[o]]=t[n[o]])}return i};const F={members:[],type:"round-convex",nonMembers:[],style:{fill:"lightblue",stroke:"blue",opacity:.2},padding:10},B=(t,e)=>{const{style:i={}}=t,n=z(t,["style"]),{style:o={}}=e,s=z(e,["style"]);return Object.assign(Object.assign(Object.assign({},n),s),{style:Object.assign(Object.assign({},i),o)})};let R;const W=[{type:"graphin-force",options:{},title:"渐进力导"},{type:"force",title:"D3力导",options:{preventOverlap:!0,linkDistance:250,nodeStrength:30,edgeStrength:.1,collideStrength:.8,nodeSize:30,alpha:.3,alphaDecay:.028,alphaMin:.01,forceSimulation:null,clustering:!1}},{type:"concentric",title:"同心圆布局",options:{minNodeSpacing:60,preventOverlap:!0,nodeSize:60}},{type:"grid",options:{},title:"网格布局"},{type:"radial",options:{},title:"辐射布局"},{type:"dagre",title:"层次布局",options:{}},{type:"circular",options:{},title:"环形布局"},{type:"gForce",options:{linkDistance:()=>200,preventOverlap:!0},title:"G6力导"},{type:"mds",options:{},title:"降维布局"},{type:"random",options:{},title:"随机布局"}],G=W.map((t=>{const{type:e,options:i}=t;return Object.assign({type:e},i)})).reduce(((t,e)=>Object.assign(Object.assign({},t),{[e.type]:e})),{}),Z=()=>({type:"circle",style:{labelCfg:{position:"top"}},status:{}}),q={primaryEdgeColor:"#ddd",edgeSize:1,mode:"light"},V=t=>{const{edgeSize:e,primaryEdgeColor:i,mode:n}=Object.assign(Object.assign({},q),t),o={light:{stroke:i,label:i,disabled:"#ddd"},dark:{stroke:i,label:i,disabled:"#ddd3"}}[n];return{type:"graphin-line",style:{keyshape:{type:"line",lineWidth:e,stroke:o.stroke,strokeOpacity:1,lineAppendWidth:9,cursor:"pointer"},halo:{visible:!1,cursor:"pointer",strokeOpacity:.4},label:{value:"",position:"top",fill:o.label,fontSize:12,textAlign:"center"},animate:{}},status:{hover:{halo:{visible:!0}},selected:{halo:{visible:!0},keyshape:{lineWidth:2},label:{visible:!0}},active:{halo:{visible:!0},keyshape:{lineWidth:2},label:{visible:!0}},inactive:{halo:{visible:!1},keyshape:{strokeOpacity:.1},label:{visible:!1}},disabled:{halo:{visible:!1},keyshape:{lineWidth:.5,stroke:o.disabled},label:{visible:!1}}}}},H={primaryColor:"#FF6A00",nodeSize:26,mode:"light"},U=t=>{const{nodeSize:e,primaryColor:i,mode:n}=Object.assign(Object.assign({},H),t),o={light:{fill:i,fillOpacity:.1,stroke:i,strokeOpacity:1,icon:i,badge:{fill:i,stroke:i,font:"#fff"},label:"#000",disabled:"#ddd"},dark:{fill:i,fillOpacity:.3,stroke:i,strokeOpacity:1,icon:"#fff",badge:{fill:i,stroke:i,font:"#fff"},label:"#fff",disabled:"#ddd3"}}[n];return{type:"graphin-circle",style:{keyshape:{size:e,fill:o.fill,fillOpacity:o.fillOpacity,stroke:o.stroke,strokeOpacity:o.strokeOpacity,lineWidth:1,opacity:1,type:"circle"},label:{position:"bottom",value:"",fill:o.label,fontSize:12,offset:0,background:void 0,fillOpacity:1},icon:{type:"text",value:"",size:e/2,fill:o.icon,fillOpacity:1,offset:[0,0]},badges:[],halo:{visible:!1,fillOpacity:.1}},status:{normal:{},selected:{halo:{visible:!0},keyshape:{lineWidth:5}},hover:{halo:{visible:!0}},active:{},inactive:{keyshape:{fillOpacity:.04,strokeOpacity:.04},icon:{fillOpacity:.04},label:{fillOpacity:.04}},disabled:{halo:{visible:!1},keyshape:{fill:o.disabled,stroke:o.disabled},icon:{fill:o.disabled},label:{fill:o.disabled}}}}},X=t=>Array.from(String(t)).reduce(((t,e)=>e.charCodeAt(0)>255?t+2:t+1),0);var Y=o(808);const K=t=>Math.floor(Math.random()*t),Q={},J=t=>"#"===t.charAt(0)?t.slice(1):t,tt=t=>{const e=3===t.length||4===t.length;return{r:e?`${t.slice(0,1)}${t.slice(0,1)}`:t.slice(0,2),g:e?`${t.slice(1,2)}${t.slice(1,2)}`:t.slice(2,4),b:e?`${t.slice(2,3)}${t.slice(2,3)}`:t.slice(4,6),a:(e?`${t.slice(3,4)}${t.slice(3,4)}`:t.slice(6,8))||"ff"}},et=t=>parseInt(t,16),it=({r:t,g:e,b:i,a:n})=>({r:et(t),g:et(e),b:et(i),a:+(et(n)/255).toFixed(2)});class nt{constructor(t){this.nodeIds=[],this.bfs=t=>{var e;if(!this.root)return;const i=[];for(i.push(this.root);i.length;){const n=i.shift();if(t(n))return n;(null===(e=null==n?void 0:n.children)||void 0===e?void 0:e.length)&&i.push(...n.children)}},this.getRoot=()=>this.root,this.getNode=t=>this.bfs((e=>e.id===t)),this.addRoot=(t,e)=>{this.root={id:t,children:[]},this.nodeIds.push(t)},this.addNode=t=>{const{parentId:e,id:i,data:n}=t;if(!this.root)return void this.addRoot(i,n);let o;if(e)o=this.getNode(e);else{const t=Math.floor(Math.random()*this.nodeIds.length);o=this.getNode(this.nodeIds[t])}o?(this.nodeIds.push(i),o.children.push({id:i,parent:o,children:[]})):console.error("Parent node doesn't exist!")},t&&(this.root=t)}}const ot=(t,e)=>{e(t),t.children&&t.children.length>0&&t.children.forEach((t=>{ot(t,e)}))},st=ot,rt={nodeCount:10,nodeType:"company"};class at{constructor(t){this.initNodes=()=>{const{nodeCount:t,nodeType:e}=this.options,i=Array.from({length:t});this.nodes=i.map(((t,i)=>({id:`node-${i}`,label:`node-${i}`,type:e})));for(let e=0;e<t;e+=1)for(let i=0;i<t-1;i+=1)this.edges.push({source:`node-${e}`,target:`node-${i}`});this.nodeIds=this.nodes.map((t=>t.id))},this.expand=t=>(this.edges=[],this.nodes=[],t.forEach((t=>{for(let e=0;e<this.options.nodeCount;e+=1)this.nodes.push({id:`${t.id}-${e}`,type:t.type}),this.edges.push({source:`${t.id}-${e}`,target:t.id})})),this),this.type=t=>(this.nodes=this.nodes.map((e=>Object.assign(Object.assign({},e),{type:t}))),this),this.circle=(t="")=>{let e=t;return-1===this.nodeIds.indexOf(e)&&(e="node-0"),this.edges=this.edges.filter((t=>t.source===e||t.target===e)),this},this.random=(t=.5)=>{const{nodeCount:e}=this.options,i=parseInt(String(e*t)),n=this.nodeIds.sort((()=>Math.random()-.5)).slice(0,i);return this.edges=this.edges.filter((t=>-1!==n.indexOf(t.target))),this.edges=this.edges.sort((()=>Math.random()-.5)).slice(0,i),this},this.tree=()=>{this.edges=[],this.treeData=new nt;const t=this.nodeIds[0];return this.nodeIds.forEach((t=>{this.treeData.addNode({id:t,style:{label:{value:t}}})})),this.treeData.bfs((e=>{var i;return e.id!==t&&this.edges.push({source:null===(i=null==e?void 0:e.parent)||void 0===i?void 0:i.id,target:e.id,properties:[]}),!1})),this},this.value=()=>({nodes:this.nodes,edges:this.edges}),this.combos=t=>{const e=new Set;return this.nodes=this.nodes.map(((i,n)=>{const o=`combo-${Math.ceil((n+1)/t)}`;return e.add(o),Object.assign(Object.assign({},i),{comboId:o})})),this.combosData=[...e].map((t=>({id:t,label:t}))),this},this.graphin=()=>({nodes:this.nodes.map((t=>Object.assign(Object.assign({},t),{id:t.id,type:"graphin-circle",comboId:t.comboId,style:{label:{value:`${t.id}`}}}))),edges:this.edges.map((t=>({source:t.source,target:t.target}))),combos:this.combosData}),this.graphinTree=()=>{const t=this.treeData.getRoot();return st(t,(t=>{delete t.parent})),t},this.options=rt,this.options.nodeCount=t,this.nodes=[],this.edges=[],this.nodeIds=[],this.treeData=new nt,this.initNodes()}}function lt(t){return t%2==0}const ct=(t,e)=>e.split(".").reduce(((t,e,i,n)=>{const o=t[e];return o||i===n.length-1?o:{}}),t),dt={hexToRgba:(t,e)=>{const i=J(t),n=tt(i);return((t,e)=>{const{r:i,g:n,b:o,a:s}=t;var r;return`rgba(${i}, ${n}, ${o}, ${r=e,!isNaN(parseFloat(String(r)))&&isFinite(Number(r))?e:s})`})(it(n),e)},debug:t=>(Q[t]||(Q[t]=((t=1)=>`rgba(${K(255)},${K(255)},${K(255)},${t})`)()),Q[t],(...t)=>{}),mock:t=>new at(t),shallowEqual:(t,e)=>{let i=!0;const n=Object.keys(t),o=Object.keys(e);if(n.length!==o.length)return!1;for(let o=0;o<n.length;o++){const s=n[o];if(t[s]!==e[s]){i=!1;break}}return i},hexToRgbaToHex:(t,e=1)=>{const i=J(t),n=tt(i),o=it(n),{r:s,g:r,b:a}=o;let l=s.toString(16),c=r.toString(16),d=a.toString(16),h=Math.round(255*Number(e)).toString(16);return 1===l.length&&(l=`0${l}`),1===c.length&&(c=`0${c}`),1===d.length&&(d=`0${d}`),1===h.length&&(h=`0${h}`),`#${l}${c}${d}${h}`},getNodeStyleByTheme:U,getEdgeStyleByTheme:V,getComboStyleByTheme:Z,deepMix:C,cloneDeep:Y.Z,uuid:()=>{function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return`${t()+t()}-${t()}-${t()}-${t()}-${t()}${t()}${t()}`},walk:st,processEdges:(t,{poly:e=30,loop:i=10,loopLabelPosition:n=1}={poly:30,loop:10,loopLabelPosition:1})=>{const o={};t.forEach(((t,e)=>{const i=Object.assign({},t),{source:n,target:s}=i,r=`${n}-${s}`;i.id=i.id||`${n}-${s}-${e}`;const a=`${s}-${n}`;o[r]?o[r].push(i):o[a]?(i.revert=!0,o[a].push(i)):o[r]=[i]}));const s=Object.values(o),r=[];return s.forEach((t=>{if(t.length>1){const o=lt(t.length);t.forEach(((t,s)=>{var a;const{source:l,target:c}=t,d=l===c,h=s;let u;if(o){const t=Math.ceil((h+1)/2);u=e*t}else{const t=lt(h)?h:h+1,i=Math.ceil(t/2);u=e*i}let p,g=lt(h)?u:-u;if(t.revert&&(g=-g,delete t.revert),d){const e=h*i;if(p={type:"loop",loop:{distance:e}},null===(a=t.style)||void 0===a?void 0:a.label){const i=0,o=-(30*n+2*e);t.style.label.offset=[i,o]}}else p={type:"poly",poly:{distance:g}};C(t,{style:{keyshape:p}}),t.isMultiple=!0,r.push(t)}))}else r.push(t[0])})),r},calcByteLength:X,layouts:W,uniqBy:(t,e)=>t.reduce(((t,i)=>(t.some((t=>e(i,t)))||t.push(i),t)),[]),getEnumDataMap:(t,e)=>{const i=new Map;return t.forEach((t=>{const n=ct(t,e),o=i.get(n);o?i.set(n,[...o,t]):i.set(n,[t])})),i},getEnumValue:ct},{getEnumValue:ht,getEnumDataMap:ut}=dt,pt=({bindType:t="node",sortKey:e})=>{const i=n().useContext(r),{graph:o}=i,s=o.save();if(s.children)return console.error("not support tree graph"),{dataMap:new Map,options:{}};const a=ut(s[`${t}s`],e),l=[...a.keys()].map((t=>{const e=(a.get(t)||[{}])[0],i=ht(e,"style.keyshape.fill"),n=ht(e,"style.color");return{color:i||n,value:t,label:t,checked:!0}}));return{dataMap:a,options:l}},gt={position:"absolute",top:"0px",right:"0px"},ft=t=>{const{bindType:e="node",sortKey:i,children:o,style:s}=t,{dataMap:r,options:a}=pt({bindType:e,sortKey:i});return n().createElement("div",{className:"graphin-components-legend",style:Object.assign(Object.assign({},gt),s)},o({bindType:e,sortKey:i,dataMap:r,options:a}))};ft.Node=t=>{const{graph:e,theme:o}=n().useContext(r),{options:s,dataMap:a,onChange:l}=t,{mode:c}=o,[d,h]=n().useState({options:s});(0,i.useEffect)((()=>{h({options:s})}),[s]);const{options:u}=d,p=t=>{const i=Object.assign(Object.assign({},t),{checked:!t.checked}),n=u.map((e=>e.value===t.value?i:e));h({options:n}),a.get(i.value).forEach((t=>{e.setItemState(t.id,"active",i.checked),e.setItemState(t.id,"inactive",!i.checked);const{id:n}=t;e.findById(n).getEdges().forEach((t=>{e.setItemState(t,"normal",i.checked),e.setItemState(t,"inactive",!i.checked)}))})),l(i,n)};return n().createElement("ul",{className:"graphin-components-legend-content"},u.map((t=>{const{label:e,checked:i,color:o}=t,s={light:{active:o,inactive:"#ddd"},dark:{active:o,inactive:"#2f2f2f"}},r=i?"active":"inactive";return n().createElement("li",{key:t.value,className:"item",onClick:()=>{p(t)},onKeyDown:()=>{p(t)}},n().createElement("span",{className:"dot",style:{background:s[c][r]}}),n().createElement("span",{className:"label",style:{color:{light:{active:"#000",inactive:"#ddd"},dark:{active:"#fff",inactive:"#2f2f2f"}}[c][r]}},e))})))};const yt=ft,mt={className:"graphin-minimap",viewportClassName:"graphin-minimap-viewport",type:"default",padding:50,size:[200,120],delegateStyle:{fill:"#40a9ff",stroke:"#096dd9"},refresh:!0},vt={position:"absolute",bottom:0,left:0,background:"#fff",boxShadow:"0px 8px 10px -5px rgba(0,0,0,0.2), 0px 16px 24px 2px rgba(0,0,0,0.14), 0px 6px 30px 5px rgba(0,0,0,0.12)"};let bt=null;const xt={line:{stroke:"#FA8C16",lineWidth:.5},itemAlignType:"center"},Ot=t=>{const{bindType:e="node",container:o}=t,s=n().useContext(r),{graph:a}=s,l=(0,i.useRef)(),[c,d]=n().useState({visible:!1,x:0,y:0,item:null}),h=t=>{t.preventDefault(),t.stopPropagation(),l.current&&window.clearTimeout(l.current);const i=a.getPointByClient(t.clientX,t.clientY);let{x:n,y:o}=a.getCanvasByPoint(i.x,i.y);if("node"===e&&t.item){const{x:e=0,y:i=0}=t.item.getModel(),s=a.getCanvasByPoint(e,i),r=t.canvasX-s.x,l=t.canvasY-s.y;n-=r,o-=l}d((e=>Object.assign(Object.assign({},e),{visible:!0,item:t.item,x:n,y:o})))},u=()=>{l.current&&window.clearTimeout(l.current),l.current=window.setTimeout((()=>{d((t=>Object.assign(Object.assign({},t),{visible:!1,item:null,x:0,y:0})))}),200)},p=()=>{d(Object.assign(Object.assign({},c),{visible:!1,x:0,y:0,item:null}))},g=t=>{const i=a.getPointByClient(t.clientX,t.clientY);let{x:n,y:o}=a.getCanvasByPoint(i.x,i.y);if("node"===e){if(t.item){const{x:e=0,y:i=0}=t.item.getModel(),s=a.getCanvasByPoint(e,i);n-=t.canvasX-s.x,o-=t.canvasY-s.y}d(Object.assign(Object.assign({},c),{visible:!0,x:n,y:o,item:t.item}))}},f=()=>{clearTimeout(l.current)};return(0,i.useEffect)((()=>{var t,i;return a.on(`${e}:mouseenter`,h),a.on(`${e}:mouseleave`,u),a.on("afterremoveitem",u),a.on("node:dragstart",p),a.on("node:dragend",g),null===(t=o.current)||void 0===t||t.addEventListener("mouseenter",f),null===(i=o.current)||void 0===i||i.addEventListener("mouseleave",u),()=>{var t,i;console.log("effect..remove...."),a.off(`${e}:mouseenter`,h),a.off(`${e}:mouseleave`,u),a.off("afterremoveitem",u),a.off("node:dragstart",p),a.off("node:dragend",g),null===(t=o.current)||void 0===t||t.removeEventListener("mouseenter",f),null===(i=o.current)||void 0===i||i.removeEventListener("mouseleave",u)}}),[]),Object.assign({},c)},wt={width:"120px",boxShadow:"0 4px 12px rgb(0 0 0 / 15%)"},jt=n().createRef(),St={ContextMenu:t=>{const{bindType:e,children:i,style:o}=t,s=D({bindType:e,container:T}),{visible:r,x:a,y:l,item:c}=s,d={position:"absolute",left:a,top:l};if("function"!=typeof i)return console.error("<ContextMenu /> children should be a function"),null;const h=c&&!c.destroyed&&c.getModel&&c.getModel().id||"";return n().createElement("div",{ref:T,className:"graphin-components-contextmenu",style:Object.assign(Object.assign(Object.assign({},L),o),d),key:h},r&&i(Object.assign(Object.assign({},s),{id:h})))},Hull:t=>{const e=n().useContext(r),{graph:i}=e,{options:o}=t;return n().useEffect((()=>{R&&R.length&&R.forEach((t=>i.removeHull(t))),R=o.map((t=>i.createHull(B(F,Object.assign({id:`${Math.random()}`},t)))));const t=E((()=>{R.forEach(((t,e)=>{t.group.destroyed?R[e]=i.createHull(B(F,Object.assign({id:`${Math.random()}`},o[e]))):t.updateData(t.members)}))}));return i.on("afterupdateitem",t),i.on("aftergraphrefreshposition",t),()=>{i.off("afterupdateitem",t),i.off("aftergraphrefreshposition",t)}}),[i,o]),null},MiniMap:t=>{const{graph:e}=n().useContext(r),{options:i,style:o={}}=t;n().useEffect((()=>{const t=e.getWidth(),n=e.getHeight(),o=e.get("fitViewPadding"),s=[(t-2*o)/(n-2*o)*120,120],r=Object.assign(Object.assign(Object.assign({container:bt},mt),{size:s}),i),a=new(I().Minimap)(r);return e.addPlugin(a),()=>{a&&!a.destroyed&&e.removePlugin(a)}}),[i]);const s=Object.assign(Object.assign({},vt),o);return n().createElement("div",{ref:t=>{bt=t},style:s})},FishEye:t=>{const{graph:e}=n().useContext(r),{options:i,visible:o,handleEscListener:s}=t;return n().useEffect((()=>{const t=Object.assign(Object.assign({},$),i);t.showLabel&&e.getNodes().forEach((t=>{t.getContainer().getChildren().forEach((t=>{"text"===t.get("type")&&t.hide()}))}));const n=new(I().Fisheye)(t),r=t=>{27===t.keyCode&&s&&(s(),e.get("canvas").setCursor("default"))};return o&&(e.addPlugin(n),e.get("canvas").setCursor("zoom-in")),s&&window.addEventListener("keydown",r),()=>{e&&!e.destroyed&&(e.get("canvas").setCursor("default"),e.removePlugin(n)),s&&window.removeEventListener("keydown",r)}}),[e,i,o,s]),null},SnapLine:t=>{const{graph:e}=n().useContext(r),{options:i,visible:o}=t;return n().useEffect((()=>{const t=Object.assign(Object.assign({},xt),i),n=new(I().SnapLine)(t);return o&&e.addPlugin(n),()=>{e&&!e.destroyed&&e.removePlugin(n)}}),[e,i,o]),null},Tooltip:t=>{const{children:e,bindType:i="node",style:o,placement:s="top",hasArrow:a}=t,{x:l,y:c,visible:d,item:h}=Ot({bindType:i,container:jt}),{graph:u}=n().useContext(r);let p=40;try{if(h){const{type:t}=h.getModel();if("graphin-cirle"===t){const{style:t}=h.getModel();t&&(p=t.keyshape.size)}}}catch(t){console.log(t)}const g=(({graph:t,placement:e,nodeSize:i,x:n,y:o,bindType:s="node",visible:r})=>"edge"===s?r?{left:n,top:o}:{visibility:"hidden",left:n,top:o}:("auto"===e&&(e=function(t,e,i){const n=t.get("canvas"),o=n.get("width"),s=n.get("height"),r=i<=s/4,a=i>=3*s/4,l=e<=o/4,c=e>=3*o/4;return l&&r?"bottom-right":c&&r?"bottom-left":l&&a?"top-right":c&&a?"top-left":r?"bottom":a?"top":l?"right":c?"left":"center"}(t,n,o)),"top"===e?r?{left:n,top:o-i/2,opacity:1,transform:"translate(-50%,calc(-100% - 6px))",transition:"opacity 0.5s,transform 0.5s"}:{visibility:"hidden",left:0,top:0,opacity:0,transform:"translate(-50%,-100%)",transition:"opacity 0.5s,transform 0.5s"}:"bottom"===e?r?{left:n,top:o+i/2,opacity:1,transform:"translate(-50%,6px)",transition:"opacity 0.5s,transform 0.5s"}:{visibility:"hidden",left:n,top:o+i/2,opacity:0,transform:"translate(-50%,0px)",transition:"opacity 0.5s,transform 0.5s"}:"left"===e?r?{left:n-i/2,top:o,transform:"translate(calc(-100% - 6px),-50%)",opacity:1,transition:"opacity 0.5s,transform 0.5s"}:{visibility:"hidden",opacity:0,left:n-i/2,top:o,transform:"translate(-100%,-50%)",transition:"opacity 0.5s,transform 0.5s"}:"right"===e?r?{left:n+i/2,top:o,transform:"translate(6px,-50%)",opacity:1,transition:"opacity 0.5s,transform 0.5s"}:{visibility:"hidden",left:n+i/2,top:o,transform:"translate(0,-50%)",opacity:0,transition:"opacity 0.5s,transform 0.5s"}:"top-left"===e?r?{left:n-i/2,top:o-i/2,opacity:1,transform:"translate(calc(-100% - 6px),calc(-100% - 6px))",transition:"opacity 0.5s,transform 0.5s"}:{left:n-i/2,top:o-i/2,opacity:0,transform:"translate(-100%,-100%)",transition:"opacity 0.5s,transform 0.5s"}:"top-right"===e?r?{left:n+i/2,top:o-i/2,opacity:1,transform:"translate(6px,calc(-100% - 6px))",transition:"opacity 0.5s,transform 0.5s"}:{left:n+i/2,top:o-i/2,opacity:0,transform:"translate(0,-100%)",transition:"opacity 0.5s,transform 0.5s"}:"bottom-left"===e?r?{left:n-i/2,top:o+i/2,opacity:1,transform:"translate(calc(-100% - 6px),6px)",transition:"opacity 0.5s,transform 0.5s"}:{left:n-i/2,top:o+i/2,opacity:0,transform:"translate(-100%,0px)",transition:"opacity 0.5s,transform 0.5s"}:"bottom-right"===e?r?{left:n+i/2,top:o+i/2,opacity:1,transform:"translate(6px,6px)",transition:"opacity 0.5s,transform 0.5s"}:{left:n+i/2,top:o+i/2,opacity:0,transform:"translate(0,0)",transition:"opacity 0.5s,transform 0.5s"}:"center"===e?r?{left:n,top:o,opacity:1,transition:"opacity 0.5s,transform 0.5s"}:{visibility:"hidden",left:n,top:o,opacity:0,transition:"opacity 0.5s,transform 0.5s"}:{left:n,top:o}))({graph:u,placement:s,nodeSize:p+12,x:l,y:c,bindType:i,visible:d}),f=Object.assign({position:"absolute"},g);if("function"!=typeof e)return console.error("<Tooltip /> children should be a function"),null;const y=h&&!h.destroyed&&h.getModel&&h.getModel()||{},m=y.id||"";return n().createElement(n().Fragment,null,n().createElement("div",{ref:jt,className:`graphin-components-tooltip ${s}`,style:Object.assign(Object.assign(Object.assign({},wt),f),o)},d&&n().createElement("div",null,a&&n().createElement("div",{className:`tooltip-arrow ${s}`}),e({item:h,bindType:i,model:y,id:m}))))},Legend:yt,useLegend:pt,useTooltip:Ot,useContextMenu:D},Et=t=>()=>{if(!t||t.destroyed)return;const e=t.getZoom(),i=t.get("canvas"),n=i.getPointByClient(i.get("width")/2,i.get("height")/2),o=i.get("pixelRatio")||1,s=1.25;return s*e>5?void 0:(t.zoom(s,{x:n.x/o,y:n.y/o}),{text:`${Math.round(s*e*100)}%`,ratio:s*e})},_t=t=>()=>{if(!t||t.destroyed)return;const e=t.getZoom(),i=t.get("canvas"),n=i.getPointByClient(i.get("width")/2,i.get("height")/2),o=i.get("pixelRatio")||1,s=.75;return s*e<.3?void 0:(t.zoom(s,{x:n.x/o,y:n.y/o}),{text:`${Math.round(s*e*100)}%`,ratio:s*e})},Ct=t=>({text:e,ratio:i})=>{if(!t||t.destroyed)return;const n=t.get("canvas"),o=n.getPointByClient(n.get("width")/2,n.get("height")/2),s=n.get("pixelRatio")||1;return t.zoomTo(i,{x:o.x/s,y:o.y/s}),{text:e,ratio:i}},Nt=t=>()=>{if(!t||t.destroyed)return;const e=t.getZoom();return t.zoom(1/e),t.fitCenter(),{text:"100%",ratio:1}},kt=t=>()=>{if(!t||t.destroyed)return;t.getNodes().length>0&&t.fitView([20,20]);const e=t.getZoom();return{text:`${Math.round(100*e)}%`,ratio:e}},Mt=t=>e=>{t.getNodes().forEach((i=>{t.clearItemStates(i,["active","inactive"]),-1!==e.indexOf(i.get("id"))?t.setItemState(i,"active",!0):t.setItemState(i,"active",!1)}))},Pt=t=>e=>{if(!t||"string"!=typeof e)return;const i=t.findById(e);i?(t.focusItem(e,!0,{duration:300,easing:"easeCubic"}),t.setItemState(i,"selected",!0),i.toFront()):console.warn(`The node ${e} does not exist!`)},Dt=Object.assign(Object.assign({},t),e),Lt=t=>Object.keys(Dt).reduce(((e,i)=>Object.assign(Object.assign({},e),{[i]:Dt[i](t)})),{}),Tt={type:"compactBox",direction:"LR",getId:function(t){return t.id},getHeight:function(){return 16},getWidth:function(){return 16},getVGap:function(){return 80},getHGap:function(){return 20}},At=["dendrogram","compactBox","mindmap","indented"],It={type:"force2"},$t=()=>Math.round(80*(Math.random()-.5)),zt=t=>!t||!t.nodes||0===t.nodes.length,Ft=["force","graphin-force","g6force","gForce","comboForce"],Bt=class{constructor(t){this.updateOptions=()=>{const t={type:"concentric"},{width:e,height:i,props:n}=this.graphin,{layout:o=t}=n,{type:s="concentric",preset:r}=o,a={width:e,height:i,center:[e/2,i/2]};if(this.options=Object.assign(Object.assign(Object.assign({},a),G[s]||{}),o),zt(this.graphin.data))this.prevOptions={};else if(-1!==Ft.indexOf(s)){let t=this.prevOptions.type||"grid";(null==r?void 0:r.type)&&(t=r.type),zt(this.graphin.data)&&(t=r.type||"grid"),this.options.preset=Object.assign(Object.assign(Object.assign({type:t},a),G[t]||{}),r)}},this.processForce=()=>{const t=this,{options:e,graphin:i}=t,{graph:n}=i,{type:o,animation:s,animate:r}=e;if("graphin-force"===o&&(t.options.graph=n),"force"===o||"g6force"===o||"gForce"===o||"comboCombined"===o){const{onTick:e}=t.options,i=()=>{e&&e(),(s||r)&&t.refreshPosition()};t.options.tick=i;const{onLayoutEnd:o}=t.options;t.options.onLayoutEnd=()=>{t.refreshPosition(),null==o||o(),n.emit("afterlayout")}}"comboForce"!==o&&"comboCombined"!==o||(t.options.comboTrees=n.get("comboTrees"));const a=-1!==Ft.indexOf(t.prevOptions.type),l=-1!==Ft.indexOf(t.options.type),c=t.options.type===t.prevOptions.type;if(!zt(i.data)){if(l&&!c){const{preset:e}=t.options;t.presetLayout=new(I().Layout[e.type])(Object.assign({},e)||{}),t.presetLayout.init(i.data),t.presetLayout.execute(),t.presetLayout.data=Object.assign({},i.data)}if(l&&a&&!t.hasPosition()){let e=t.graph.save();const{preset:n}=t.options;zt(e)&&(t.presetLayout=new(I().Layout[n.type])(Object.assign({},n)||{}),t.presetLayout.init(i.data),t.presetLayout.execute(),e=i.data),i.data=((t,e)=>{const{nodes:i,edges:n}=t,{nodes:o}=e,s=new Map;o.forEach((t=>{const{id:e,x:i,y:n}=t;s.set(e,{x:i,y:n})}));const r=new Map;i.forEach((t=>{const{id:e}=t,{x:i,y:n}=s.get(e);window.isNaN(i)||window.isNaN(n)?r.set(e,t):(t.x=i,t.y=n)}));const a=new Map;return n.forEach((t=>{const{source:e,target:i}=t,n=r.get(e),o=r.get(i),l=s.get(e),c=!window.isNaN(l.x)&&!window.isNaN(l.y),d=s.get(i),h=!window.isNaN(d.x)&&!window.isNaN(d.y);n&&h&&a.set(e,{x:d.x+$t(),y:d.y+$t()}),o&&c&&a.set(i,{x:l.x+$t(),y:l.y+$t()})})),i.forEach((t=>{const{id:e}=t;let i=s.get(e);(window.isNaN(i.x)||window.isNaN(i.y))&&(i=a.get(e)||{}),window.isNaN(i.x)||window.isNaN(i.y)?(t.x=250+Math.round(500*Math.random()),t.y=150+Math.round(300*Math.random())):(t.x=i.x,t.y=i.y)})),Object.assign(Object.assign({},t),{nodes:i,edges:n})})(i.data,e)}}},this.refreshPosition=()=>{const{graphin:t}=this,{animate:e,layoutAnimate:i}=t.options,{type:n}=this.options;!e||i||this.options.animation?this.graph.refreshPositions("comboCombined"===n):this.graph.positionsAnimate("comboCombined"===n)},this.destroy=()=>{this.presetLayout&&this.presetLayout.destroy&&this.presetLayout.destroy(),this.instance&&this.instance.destroy&&this.instance.destroy(),this.presetLayout=null,this.instance=null},this.getDataFromGraph=()=>{const t=[],e=[],i=[],n=[],o=this.graph.getNodes(),s=this.graph.getEdges(),r=this.graph.getCombos(),a=o.length;for(let e=0;e<a;e++){const i=o[e];if(i&&i.isVisible()){const e=i.getModel();t.push(e)}}const l=s.length;for(let t=0;t<l;t++){const i=s[t];if(i&&i.isVisible()){const t=i.getModel();t.isComboEdge?n.push(t):e.push(t)}}const c=r.length;for(let t=0;t<c;t++){const e=r[t];if(e&&e.isVisible()){const t=e.getModel();i.push(t)}}return{nodes:t,edges:e,combos:i,comboEdges:n}},this.graphin=t,this.graph=this.graphin.graph,this.presetLayout=null,this.prevOptions={},this.init()}hasPosition(){const{graphin:t}=this,{data:e={}}=t;return!!e.nodes&&0!==e.nodes.length&&e.nodes.every((t=>!window.isNaN(Number(t.x))&&!window.isNaN(Number(t.y))))}init(){this.updateOptions();const{options:t,graphin:e}=this,{data:i}=e,{type:n}=t;this.processForce(),I().Layout[n]||console.warn(`${n} layout not found, current layout is grid`);const o=I().Layout[n]||I().Layout.grid;this.graph.emit("beforelayout"),this.instance=new o(this.options),this.instance.init(i)}start(){const{type:t}=this.options;this.instance.execute(),"force"!==t&&"g6force"!==t&&"gForce"!==t&&"comboCombined"!==t&&"force2"!==t&&(this.refreshPosition(),this.graph.emit("afterlayout"))}changeLayout(){const{graph:t,data:e,isTree:i,layoutCache:n}=this.graphin;if(!t||t.destroyed||!e||!e.nodes||!e.nodes.length||n&&this.hasPosition()||i)return!1;-1!==Ft.indexOf(this.options.type)&&this.destroy(),this.prevOptions=Object.assign({},this.options),this.init(),this.start()}},Rt={mode:"light",primaryColor:"#873bf4",nodeSize:26,edgeSize:1,primaryEdgeColor:"#ddd"},Wt=t=>{const e=Object.assign(Object.assign({},Rt),t),{primaryColor:i,primaryEdgeColor:n,nodeSize:o,edgeSize:s,mode:r,background:a}=e,l=U({primaryColor:i,nodeSize:o,mode:r}),c=V({primaryEdgeColor:n,edgeSize:s,mode:r}),d={type:"circle",style:{labelCfg:{position:"top"}},status:{}};return Object.assign(Object.assign({},e),{mode:r,background:a||{light:"#fff",dark:"#1f1f1f"}[r],defaultNodeStyle:{type:l.type,style:l.style},defaultNodeStatusStyle:{status:l.status},defaultEdgeStyle:{type:c.type,style:c.style},defaultEdgeStatusStyle:{status:c.status},defaultComboStyle:{type:d.type,style:d.style},defaultComboStatusStyle:{status:d.status}})},Gt=(t,e)=>{if(window.isNaN(t)&&window.isNaN(e)&&"number"==typeof t&&"number"==typeof e)return!0;if(t===e)return!0;if("function"==typeof t&&"function"==typeof e||t instanceof Date&&e instanceof Date||t instanceof RegExp&&e instanceof RegExp||t instanceof String&&e instanceof String||t instanceof Number&&e instanceof Number)return t.toString()===e.toString();if(!(t instanceof Object&&e instanceof Object))return!1;const i=[],n=Object.keys(t),o=Object.keys(e);if(n.length!==o.length)return!1;for(let o=0;o<n.length;o++){const s=n[o],r=Gt(t[s],e[s]);i.push(r)}return i.every((t=>t))},Zt=Gt,qt={animation:"animate",minDistanceThreshold:"minMovement",maxIterations:"maxIterations"},Vt=(t,e)=>{if(!t)return t;const i={};if(Object.keys(t).forEach((n=>{var o;if("preset"===n&&(null===(o=t.preset)||void 0===o?void 0:o.type))return void(i.preset=Vt(t.preset,e));const s=qt[n];s?i[s]=t[n]:i[n]=t[n]})),t.done&&(t.onLayoutEnd?i.onLayoutEnd=i=>{t.onLayoutEnd(e,i),t.done(e,i)}:i.onLayoutEnd=i=>{t.done(e,i)}),"concentric"===i.type){const{minNodeSpacing:t=60,preventOverlap:e=!0,nodeSize:n=60}=i;i.minNodeSpacing=t,i.preventOverlap=e,i.nodeSize=n}return i};var Ht=function(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(i[n[o]]=t[n[o]])}return i};const{DragCanvas:Ut,ZoomCanvas:Xt,DragNode:Yt,DragCombo:Kt,ClickSelect:Qt,BrushSelect:Jt,ResizeCanvas:te}=P;class ee extends n().PureComponent{constructor(t){super(t),this.graphDOM=null,this.initData=t=>{t.children&&(this.isTree=!0),this.data=(0,Y.Z)(t)},this.initGraphInstance=()=>{const t=this.props,{theme:e,data:i,layout:n,width:o,height:s,defaultCombo:r={style:{},type:"graphin-combo"},defaultEdge:a={style:{},type:"graphin-line"},defaultNode:l={style:{},type:"graphin-circle"},nodeStateStyles:c,edgeStateStyles:d,comboStateStyles:h,modes:u={default:[]},animate:p,handleAfterLayout:g}=t,f=Ht(t,["theme","data","layout","width","height","defaultCombo","defaultEdge","defaultNode","nodeStateStyles","edgeStateStyles","comboStateStyles","modes","animate","handleAfterLayout"]);u.default.length>0&&console.info("%c suggestion: you can use @antv/graphin Behaviors components","color:lightgreen");const{clientWidth:y,clientHeight:m}=this.graphDOM;this.initData(i),this.width=Number(o)||y||500,this.height=Number(s)||m||500;const v=Wt(e),{defaultNodeStyle:b,defaultEdgeStyle:x,defaultComboStyle:O,defaultNodeStatusStyle:w,defaultEdgeStatusStyle:j,defaultComboStatusStyle:S}=v,E=Ht(v,["defaultNodeStyle","defaultEdgeStyle","defaultComboStyle","defaultNodeStatusStyle","defaultEdgeStatusStyle","defaultComboStatusStyle"]);this.isTree=Boolean(i.children)||-1!==At.indexOf(String(n&&n.type));const _={defaultNode:{style:Object.assign(Object.assign({},l.style),{_theme:e}),type:l.type||"graphin-circle"},defaultEdge:{style:Object.assign(Object.assign({},a.style),{_theme:e}),type:a.type||"graphin-line"},defaultCombo:{style:Object.assign(Object.assign({},r.style),{_theme:e}),type:r.type||"combo",labelCfg:r.labelCfg},nodeStateStyles:c,edgeStateStyles:d,comboStateStyles:h};this.theme=Object.assign(Object.assign({},_),E),this.options=Object.assign(Object.assign(Object.assign({container:this.graphDOM,renderer:"canvas",width:this.width,height:this.height,animate:!1!==p},_),{modes:u}),f),this.isTree?(this.options.layout=n||Tt,this.graph=new(I().TreeGraph)(this.options)):(this.useGraphinLayoutController||(this.options.layout=Vt(n,this.graph)||It),this.graph=new(I().Graph)(this.options)),this.graph.on("afterlayout",(()=>{g&&g(this.graph)})),this.graph.data(this.data),this.setTextDirection(),this.graph.render(),!this.isTree&&this.useGraphinLayoutController&&(this.layout=new Bt(this),this.layout.start()),this.initStatus(),this.apis=Lt(this.graph),this.setState({isReady:!0,context:{graph:this.graph,apis:this.apis,theme:this.theme,layout:this.layout,dragNodes:this.dragNodes,updateContext:this.updateContext}})},this.updateLayout=()=>{this.useGraphinLayoutController&&this.layout.changeLayout()},this.updateOptions=()=>Ht(this.props,[]),this.initStatus=()=>{if(!this.isTree){const{data:t}=this.props,{nodes:e=[],edges:i=[]}=t;e.forEach((t=>{const{status:e}=t;e&&Object.keys(e).forEach((i=>{this.graph.setItemState(t.id,i,Boolean(e[i]))}))})),i.forEach((t=>{const{status:e}=t;e&&Object.keys(e).forEach((i=>{this.graph.setItemState(t.id,i,Boolean(e[i]))}))}))}},this.updateContext=t=>{this.setState((e=>({context:Object.assign(Object.assign({},e.context),t)})))},this.clear=()=>{this.layout&&this.layout.destroy&&this.layout.destroy(),this.layout={},this.graph.clear(),this.data={nodes:[],edges:[],combos:[]},this.graph.destroy()};const{data:e,layout:i,width:n,height:o,layoutCache:s}=t,r=Ht(t,["data","layout","width","height","layoutCache"]);this.data=e,this.isTree=Boolean(t.data&&t.data.children)||-1!==At.indexOf(String(i&&i.type)),this.graph={},this.height=Number(o),this.width=Number(n),this.theme={},this.apis={},this.layoutCache=s,this.layout={},this.dragNodes=[],this.useGraphinLayoutController="graphin-force"===(null==i?void 0:i.type),this.options=Object.assign({},r),this.state={isReady:!1,context:{graph:this.graph,apis:this.apis,theme:this.theme,layout:this.layout,dragNodes:this.dragNodes,updateContext:this.updateContext}}}static registerBehavior(t,e){I().registerBehavior(t,e)}static registerFontFamily(t){const e=t(),{glyphs:i,fontFamily:n}=e,o=i.map((t=>({name:t.name,unicode:String.fromCodePoint(t.unicode_decimal)})));return new Proxy(o,{get:(t,e)=>{const i=t.find((t=>t.name===e));return i?null==i?void 0:i.unicode:(console.error(`%c fontFamily:${n},does not found ${e} icon`),"")}})}static registerLayout(t,e){I().registerLayout(t,e)}setTextDirection(){const{dir:t="ltr"}=this.props;this.graph.get("canvas").get("el").setAttribute("dir",t)}componentDidMount(){this.initGraphInstance()}componentDidUpdate(t){var e,i;const n=this.shouldUpdate(t,"data"),o=this.shouldUpdate(t,"layout"),s=this.shouldUpdate(t,"options"),{data:r,layoutCache:a,rtl:l,layout:c}=(this.shouldUpdate(t,"theme"),this.props),d=(0,Y.Z)(c);let h;if(this.layoutCache=a,s&&t.rtl!==l&&(this.setTextDirection(),this.graph.render()),n){if(this.initData(r),this.isTree)this.graph.changeData(this.data);else{const{context:{dragNodes:t}}=this.state;if(h=t.filter((t=>{var e;return(null===(e=this.data)||void 0===e?void 0:e.nodes)&&this.data.nodes.find((e=>e.id===t.id))})),null===(i=null===(e=this.data)||void 0===e?void 0:e.nodes)||void 0===i||i.forEach((t=>{var e,i,n,o;const s=h.find((e=>e.id===t.id));s&&(t.mass=null===(i=null===(e=s.layout)||void 0===e?void 0:e.force)||void 0===i?void 0:i.mass,t.layout=Object.assign(Object.assign({},t.layout),{force:{mass:null===(o=null===(n=s.layout)||void 0===n?void 0:n.force)||void 0===o?void 0:o.mass}}))})),this.useGraphinLayoutController)this.graph.data(this.data),this.graph.set("layoutController",null),this.graph.changeData(this.data),this.data=this.layout.getDataFromGraph(),this.layout.changeLayout();else{d&&(d.disableTriggerLayout=!0);const t=Vt(d,this.graph);this.graph.updateLayout(t),this.graph.data(this.data),this.graph.changeData(this.data),this.data=this.graph.get("data")}}return this.initStatus(),this.apis=Lt(this.graph),void this.setState((t=>Object.assign(Object.assign({},t),{context:{graph:this.graph,apis:this.apis,theme:this.theme,layout:this.layout,dragNodes:h||t.context.dragNodes,updateContext:this.updateContext}})),(()=>{this.graph.emit("graphin:datachange"),o&&this.graph.emit("graphin:layoutchange",{prevLayout:t.layout,layout:d})}))}if(o){if(this.useGraphinLayoutController="graphin-force"===(null==d?void 0:d.type),this.isTree)return void this.graph.updateLayout(d);if(this.useGraphinLayoutController)0===Object.keys(this.layout).length&&(this.layout=new Bt(this)),this.data=this.layout.getDataFromGraph(),this.layout.changeLayout();else{this.graph.get("layoutController")||this.graph.initLayoutController();const t=Vt(d,this.graph);t&&(t.disableTriggerLayout=!1),this.graph.updateLayout(t),this.data=this.graph.get("data")}this.graph.emit("graphin:layoutchange",{prevLayout:t.layout,layout:d})}}componentWillUnmount(){this.clear()}componentDidCatch(t,e){console.error("Catch component error: ",t,e)}shouldUpdate(t,e){const i=t[e],n=this.props[e];return!Zt(i,n)}render(){var t;const{isReady:e}=this.state,{modes:i,style:o,containerId:s,containerStyle:a}=this.props;return n().createElement(r.Provider,{value:this.state.context},n().createElement("div",{id:s||"graphin-container",style:Object.assign({height:"100%",width:"100%",position:"relative"},a)},n().createElement("div",{"data-testid":"custom-element",className:"graphin-core",ref:t=>{this.graphDOM=t},style:Object.assign({height:"100%",width:" 100%",minHeight:"500px",background:(null===(t=this.theme)||void 0===t?void 0:t.background)||"#fff"},o)}),n().createElement("div",{className:"graphin-components"},e&&n().createElement(n().Fragment,null,!i&&n().createElement(n().Fragment,null,n().createElement(Ut,null),n().createElement(Xt,null),n().createElement(Yt,null),n().createElement(Kt,null),n().createElement(Qt,null),n().createElement(Jt,null)),n().createElement(te,{graphDOM:this.graphDOM}),this.props.children))))}}ee.registerNode=(t,e,i)=>{I().registerNode(t,e,i)},ee.registerEdge=(t,e,i)=>{I().registerEdge(t,e,i)},ee.registerCombo=(t,e,i)=>{I().registerCombo(t,e,i)};const ie=ee,ne=(t,e,i)=>{var n,o;return"source"===t?(null===(n=null==i?void 0:i.find((t=>{var i;return(null===(i=t.target)||void 0===i?void 0:i.id)===e.id})))||void 0===n?void 0:n.source)||{}:(null===(o=null==i?void 0:i.find((t=>{var i;return(null===(i=t.source)||void 0===i?void 0:i.id)===e.id})))||void 0===o?void 0:o.target)||{}},oe=(t,e,i,n)=>{var o;const s=(null===(o=null==i?void 0:i.data)||void 0===o?void 0:o[e])||"";let r=(null==n?void 0:n.filter((t=>{var i;return(null===(i=null==t?void 0:t.data)||void 0===i?void 0:i[e])===s})))||[];return"leaf"===t&&(r=r.filter((t=>{var e,i,n,o;return 0===(null===(i=null===(e=t.data)||void 0===e?void 0:e.layout)||void 0===i?void 0:i.sDegree)||0===(null===(o=null===(n=t.data)||void 0===n?void 0:n.layout)||void 0===o?void 0:o.tDegree)}))),r},se=(t,e,i)=>{let n=[];switch(t){case"source":n=null==i?void 0:i.filter((t=>{var i;return(null===(i=t.source)||void 0===i?void 0:i.id)===e.id})).map((t=>t.target));break;case"target":n=null==i?void 0:i.filter((t=>{var i;return(null===(i=t.target)||void 0===i?void 0:i.id)===e.id})).map((t=>t.source));break;case"both":n=null==i?void 0:i.filter((t=>{var i;return(null===(i=t.source)||void 0===i?void 0:i.id)===e.id})).map((t=>t.target)).concat(null==i?void 0:i.filter((t=>{var i;return(null===(i=t.target)||void 0===i?void 0:i.id)===e.id})).map((t=>t.source)))}return n=dt.uniqBy(n,((t,e)=>t.id===e.id)),n},re={getDegree:(t,e)=>{const i=t.data.id;let n=0,o=0,s=0;return e.forEach((t=>{t.source.id===i&&(o+=1,n+=1),t.target.id===i&&(s+=1,n+=1)})),{degree:n,sDegree:o,tDegree:s}},getRelativeNodesType:(t,e)=>[...new Set(null==t?void 0:t.map((t=>{var i;return null===(i=null==t?void 0:t.data)||void 0===i?void 0:i[e]})))]||[],getCoreNodeAndRelativeLeafNodes:(t,e,i,n)=>{var o;const{sDegree:s,tDegree:r}=(null===(o=null==e?void 0:e.data)||void 0===o?void 0:o.layout)||{};let a=e,l=[];return 0===s?(a=ne("source",e,i),l=se("both",a,i)):0===r&&(a=ne("target",e,i),l=se("both",a,i)),l=l.filter((t=>{var e;return(null===(e=t.data)||void 0===e?void 0:e.layout)&&(0===t.data.layout.sDegree||0===t.data.layout.tDegree)})),{coreNode:a,relativeLeafNodes:l,sameTypeLeafNodes:oe(t,n,e,l)}},getCoreNode:ne,getSameTypeNodes:oe,getMinDistanceNode:t=>{const e=t.map((t=>t.x)),i=t.map((t=>t.y)),n=(Math.max.apply(null,e)+Math.min.apply(null,e))/2,o=(Math.max.apply(null,i)+Math.min.apply(null,i))/2,s=t.map((t=>{return e=t.x||0,i=t.y||0,Math.sqrt((e-n)*(e-n)+(i-o)*(i-o));var e,i}));return t[s.findIndex((t=>t===Math.min.apply(null,s)))]},getAvgNodePosition:t=>{let e={x:0,y:0};t.forEach((t=>{e.x+=t.x||0,e.y+=t.y||0}));const i=t.length||1;return{x:e.x/i,y:e.y/i}}};class ae{constructor(t){this.id=t.id,this.data=t||{},this.x=t.x||0,this.y=t.y||0}}class le{constructor(t,e,i,n){this.id=t,this.source=e,this.target=i,this.data=n||{}}}function ce(t,e,i,n){if(isNaN(e)||isNaN(i))return t;var o,s,r,a,l,c,d,h,u,p=t._root,g={data:n},f=t._x0,y=t._y0,m=t._x1,v=t._y1;if(!p)return t._root=g,t;for(;p.length;)if((c=e>=(s=(f+m)/2))?f=s:m=s,(d=i>=(r=(y+v)/2))?y=r:v=r,o=p,!(p=p[h=d<<1|c]))return o[h]=g,t;if(a=+t._x.call(null,p.data),l=+t._y.call(null,p.data),e===a&&i===l)return g.next=p,o?o[h]=g:t._root=g,t;do{o=o?o[h]=new Array(4):t._root=new Array(4),(c=e>=(s=(f+m)/2))?f=s:m=s,(d=i>=(r=(y+v)/2))?y=r:v=r}while((h=d<<1|c)==(u=(l>=r)<<1|a>=s));return o[u]=p,o[h]=g,t}function de(t,e,i,n,o){this.node=t,this.x0=e,this.y0=i,this.x1=n,this.y1=o}function he(t){return t[0]}function ue(t){return t[1]}function pe(t,e,i){var n=new ge(null==e?he:e,null==i?ue:i,NaN,NaN,NaN,NaN);return null==t?n:n.addAll(t)}function ge(t,e,i,n,o,s){this._x=t,this._y=e,this._x0=i,this._y0=n,this._x1=o,this._y1=s,this._root=void 0}function fe(t){for(var e={data:t.data},i=e;t=t.next;)i=i.next={data:t.data};return e}var ye=pe.prototype=ge.prototype;ye.copy=function(){var t,e,i=new ge(this._x,this._y,this._x0,this._y0,this._x1,this._y1),n=this._root;if(!n)return i;if(!n.length)return i._root=fe(n),i;for(t=[{source:n,target:i._root=new Array(4)}];n=t.pop();)for(var o=0;o<4;++o)(e=n.source[o])&&(e.length?t.push({source:e,target:n.target[o]=new Array(4)}):n.target[o]=fe(e));return i},ye.add=function(t){const e=+this._x.call(null,t),i=+this._y.call(null,t);return ce(this.cover(e,i),e,i,t)},ye.addAll=function(t){var e,i,n,o,s=t.length,r=new Array(s),a=new Array(s),l=1/0,c=1/0,d=-1/0,h=-1/0;for(i=0;i<s;++i)isNaN(n=+this._x.call(null,e=t[i]))||isNaN(o=+this._y.call(null,e))||(r[i]=n,a[i]=o,n<l&&(l=n),n>d&&(d=n),o<c&&(c=o),o>h&&(h=o));if(l>d||c>h)return this;for(this.cover(l,c).cover(d,h),i=0;i<s;++i)ce(this,r[i],a[i],t[i]);return this},ye.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var i=this._x0,n=this._y0,o=this._x1,s=this._y1;if(isNaN(i))o=(i=Math.floor(t))+1,s=(n=Math.floor(e))+1;else{for(var r,a,l=o-i||1,c=this._root;i>t||t>=o||n>e||e>=s;)switch(a=(e<n)<<1|t<i,(r=new Array(4))[a]=c,c=r,l*=2,a){case 0:o=i+l,s=n+l;break;case 1:i=o-l,s=n+l;break;case 2:o=i+l,n=s-l;break;case 3:i=o-l,n=s-l}this._root&&this._root.length&&(this._root=c)}return this._x0=i,this._y0=n,this._x1=o,this._y1=s,this},ye.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},ye.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},ye.find=function(t,e,i){var n,o,s,r,a,l,c,d=this._x0,h=this._y0,u=this._x1,p=this._y1,g=[],f=this._root;for(f&&g.push(new de(f,d,h,u,p)),null==i?i=1/0:(d=t-i,h=e-i,u=t+i,p=e+i,i*=i);l=g.pop();)if(!(!(f=l.node)||(o=l.x0)>u||(s=l.y0)>p||(r=l.x1)<d||(a=l.y1)<h))if(f.length){var y=(o+r)/2,m=(s+a)/2;g.push(new de(f[3],y,m,r,a),new de(f[2],o,m,y,a),new de(f[1],y,s,r,m),new de(f[0],o,s,y,m)),(c=(e>=m)<<1|t>=y)&&(l=g[g.length-1],g[g.length-1]=g[g.length-1-c],g[g.length-1-c]=l)}else{var v=t-+this._x.call(null,f.data),b=e-+this._y.call(null,f.data),x=v*v+b*b;if(x<i){var O=Math.sqrt(i=x);d=t-O,h=e-O,u=t+O,p=e+O,n=f.data}}return n},ye.remove=function(t){if(isNaN(s=+this._x.call(null,t))||isNaN(r=+this._y.call(null,t)))return this;var e,i,n,o,s,r,a,l,c,d,h,u,p=this._root,g=this._x0,f=this._y0,y=this._x1,m=this._y1;if(!p)return this;if(p.length)for(;;){if((c=s>=(a=(g+y)/2))?g=a:y=a,(d=r>=(l=(f+m)/2))?f=l:m=l,e=p,!(p=p[h=d<<1|c]))return this;if(!p.length)break;(e[h+1&3]||e[h+2&3]||e[h+3&3])&&(i=e,u=h)}for(;p.data!==t;)if(n=p,!(p=p.next))return this;return(o=p.next)&&delete p.next,n?(o?n.next=o:delete n.next,this):e?(o?e[h]=o:delete e[h],(p=e[0]||e[1]||e[2]||e[3])&&p===(e[3]||e[2]||e[1]||e[0])&&!p.length&&(i?i[u]=p:this._root=p),this):(this._root=o,this)},ye.removeAll=function(t){for(var e=0,i=t.length;e<i;++e)this.remove(t[e]);return this},ye.root=function(){return this._root},ye.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},ye.visit=function(t){var e,i,n,o,s,r,a=[],l=this._root;for(l&&a.push(new de(l,this._x0,this._y0,this._x1,this._y1));e=a.pop();)if(!t(l=e.node,n=e.x0,o=e.y0,s=e.x1,r=e.y1)&&l.length){var c=(n+s)/2,d=(o+r)/2;(i=l[3])&&a.push(new de(i,c,d,s,r)),(i=l[2])&&a.push(new de(i,n,d,c,r)),(i=l[1])&&a.push(new de(i,c,o,s,d)),(i=l[0])&&a.push(new de(i,n,o,c,d))}return this},ye.visitAfter=function(t){var e,i=[],n=[];for(this._root&&i.push(new de(this._root,this._x0,this._y0,this._x1,this._y1));e=i.pop();){var o=e.node;if(o.length){var s,r=e.x0,a=e.y0,l=e.x1,c=e.y1,d=(r+l)/2,h=(a+c)/2;(s=o[0])&&i.push(new de(s,r,a,d,h)),(s=o[1])&&i.push(new de(s,d,a,l,h)),(s=o[2])&&i.push(new de(s,r,h,d,c)),(s=o[3])&&i.push(new de(s,d,h,l,c))}n.push(e)}for(;e=n.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},ye.x=function(t){return arguments.length?(this._x=t,this):this._x},ye.y=function(t){return arguments.length?(this._y=t,this):this._y};function me(t){let e=0,i=0,n=0;if(t.length){for(let o=0;o<4;o++){const s=t[o];s&&s.weight&&(e+=s.weight,i+=s.x*s.weight,n+=s.y*s.weight)}t.x=i/e,t.y=n/e,t.weight=e}else{const e=t;t.x=e.data.x,t.y=e.data.y,t.weight=e.data.weight}}class ve{constructor(t,e){this.getvec=()=>this,this.add=t=>new ve(this.x+t.x,this.y+t.y),this.subtract=t=>new ve(this.x-t.x,this.y-t.y),this.magnitude=()=>Math.sqrt(this.x*this.x+this.y*this.y),this.normalise=()=>this.divide(this.magnitude()),this.divide=t=>new ve(this.x/t||0,this.y/t||0),this.scalarMultip=t=>new ve(this.x*t,this.y*t),this.x=t,this.y=e}}const be=ve,xe=class{constructor(t,e,i,n=1){this.updateAcc=t=>{this.a=this.a.add(t.divide(this.m))},this.p=t,this.m=n,this.v=new be(0,0),this.a=new be(0,0),this.id=e,this.data=i}},Oe=class{constructor(t,e,i){this.source=t,this.target=e,this.length=i}},we=class{constructor(t){this.updateOptions=t=>{t&&Object.keys(t).forEach((e=>{this.props[e]=t[e]}))},this.setData=t=>{this.nodes=[],this.edges=[],this.nodeSet={},this.edgeSet={},this.nodePoints=new Map,this.edgeSprings=new Map,this.sourceData=t,this.judgingDistance=0,("nodes"in t||"edges"in t)&&(this.addNodes(t.nodes),this.addEdges(t.edges))},this.getMass=t=>{var e;const{degree:i=(null===(e=re.getDegree(t,this.edges))||void 0===e?void 0:e.degree),force:n}=t.layout||{};return n&&n.mass?n.mass:i<5?1:5*i},this.init=()=>{const{width:t,height:e}=this.props;let{centripetalOptions:i}=this.props;const{leafCluster:n,clustering:o,nodeClusterBy:s,clusterNodeStrength:r}=this.props,a=t=>"function"==typeof r?r(t):r;let l;if(this.nodes.forEach((i=>{const n=i.data.x||t/2,o=i.data.y||e/2,s=new be(n,o);i.data.layout||(i.data.layout={});const r=re.getDegree(i,this.edges);i.data.layout=Object.assign(Object.assign({},i.data.layout),r);const a=this.getMass(i.data);this.nodePoints.set(i.id,new xe(s,String(i.id),i.data,a))})),this.edges.forEach((t=>{const e=this.nodePoints.get(t.source.id),i=this.nodePoints.get(t.target.id),n=this.props.defSpringLen(t,e,i);this.edgeSprings.set(t.id,new Oe(e,i,n))})),n){l=this.getSameTypeLeafMap();const t=re.getRelativeNodesType(this.nodes,s);i={single:100,leaf:(e,i,n)=>{const{relativeLeafNodes:o,sameTypeLeafNodes:s}=l[e.id]||{};return(null==s?void 0:s.length)===(null==o?void 0:o.length)||1===(null==t?void 0:t.length)?1:a(e)},others:1,center:(t,e,i)=>{var n;const{degree:o}=(null===(n=t.data)||void 0===n?void 0:n.layout)||{};if(!o)return{x:100,y:100};let s;if(1===o){const{sameTypeLeafNodes:e=[]}=l[t.id]||{};1===e.length?s=void 0:e.length>1&&(s=re.getAvgNodePosition(e))}else s=void 0;return{x:null==s?void 0:s.x,y:null==s?void 0:s.y}}}}if(o){l||(l=this.getSameTypeLeafMap());const t=Array.from(new Set(this.nodes.map((t=>{var e;return null===(e=t.data)||void 0===e?void 0:e[s]})))).filter((t=>void 0!==t)),e={};t.forEach((t=>{const i=this.nodes.filter((e=>{var i;return(null===(i=e.data)||void 0===i?void 0:i[s])===t}));e[t]=re.getAvgNodePosition(i)})),i={single:t=>a(t),leaf:t=>a(t),others:t=>a(t),center:(t,i,n)=>{var o;const r=e[null===(o=t.data)||void 0===o?void 0:o[s]];return{x:null==r?void 0:r.x,y:null==r?void 0:r.y}}}}this.centripetalOptions=Object.assign(Object.assign({},this.centripetalOptions),i);const{size:c}=this.nodePoints,d=Math.pow(10,2);this.props.minEnergyThreshold=.5*Math.pow(1,2)*1*c*d},this.start=()=>{this.init(),this.props.animation?this.animation():this.slienceForce()},this.calTotalEnergy=()=>{let t=0;return this.nodes.forEach((e=>{const i=this.nodePoints.get(e.id),n=i.v.magnitude(),{m:o}=i;t+=o*Math.pow(n,2)*.5})),t},this.slienceForce=()=>{const{done:t,maxIterations:e,minDistanceThreshold:i}=this.props;for(let t=0;(this.judgingDistance>i||t<1)&&t<e;t++)this.tick(this.props.tickInterval),this.iterations++;this.render(),t&&t(this.renderNodes)},this.requestAnimationFrame=t=>{const{enableWorker:e}=this.props;return e?setInterval((()=>{t()}),16):window.requestAnimationFrame(t)},this.cancelAnimationFrame=t=>{const{enableWorker:e}=this.props;e?clearInterval(t):window.cancelAnimationFrame(t)},this.animation=()=>{const{enableWorker:t,maxIterations:e,minDistanceThreshold:i,done:n,tickInterval:o}=this.props;if(t){let t=(new Date).valueOf();const o=.22,s=t=>t>10?2e3:20*t*t;for(let r=0;r<e;r++){const e=Math.max(.02,o-.002*r);this.tick(e),(new Date).valueOf()-t>=s(r)&&(this.render(),t=(new Date).valueOf());const a=this.calTotalEnergy(),l=this.registers.get("monitor");if(l&&l(this.reportMointor(a)),this.judgingDistance<i)return this.render(),void(n&&n(this.renderNodes))}return}const s=()=>{this.tick(o),this.render(),this.iterations++;const t=this.calTotalEnergy(),e=this.registers.get("monitor");e&&e(this.reportMointor(t)),this.judgingDistance<i||this.iterations>this.props.maxIterations?(this.cancelAnimationFrame(this.timer),this.iterations=0,this.done=!0,n&&n(this.renderNodes)):this.timer=this.requestAnimationFrame(s)};this.timer=this.requestAnimationFrame(s)},this.render=()=>{const t=this.registers.get("render");this.renderNodes=[],this.nodePoints.forEach((t=>{this.renderNodes.push(Object.assign(Object.assign({},this.nodeSet[t.id]&&this.nodeSet[t.id].data),{x:t.p.x,y:t.p.y}))})),t?t({nodes:this.renderNodes,edges:this.sourceData.edges}):console.error("need a render function")},this.reportMointor=t=>({energy:t,iterations:this.iterations,nodes:this.nodes,edges:this.edges}),this.tick=t=>{this.updateCoulombsLawOptimized(),this.updateHookesLaw(),this.attractToCentre(),this.attractToSide(),this.updateVelocity(t),this.updatePosition(t)},this.updateCoulombsLawOptimized=()=>{const{coulombDisScale:t}=this.props,{repulsion:e}=this.props,i=function(t,e,i){const n=i/(e*e),o=t.map(((t,e)=>Object.assign(Object.assign({index:e},t),{vx:0,vy:0,weight:n}))),s=pe(o,(t=>t.x),(t=>t.y)).visitAfter(me);return o.forEach((t=>{!function(t,e){e.visit(((e,i,n,o,s)=>{const r=t.x-e.x||.001,a=t.y-e.y||.001,l=o-i,c=r*r+a*a+.1,d=Math.sqrt(c)+.1;return l*l/.81<c?(t.vx+=r/d*e.weight/c,t.vy+=a/d*e.weight/c,!0):!e.length&&void(e.data!==t&&(t.vx+=r/d*e.data.weight/c,t.vy+=a/d*e.data.weight/c))}))}(t,s)})),o.map((t=>({vx:t.vx,vy:t.vy})))}(this.nodes.map((t=>{const e=this.nodePoints.get(t.id).p;return{x:e.x,y:e.y}})),t,e);this.nodes.forEach(((t,e)=>{this.nodePoints.get(t.id).updateAcc(new be(i[e].vx,i[e].vy))}))},this.updateCoulombsLaw=()=>{const t=this.nodes.length;for(let e=0;e<t;e++)for(let i=e+1;i<t;i++){if(e===i)continue;const t=this.nodes[e],n=this.nodes[i],{coulombDisScale:o}=this.props,{repulsion:s}=this.props,r=this.nodePoints.get(t.id).p.subtract(this.nodePoints.get(n.id).p),a=(r.magnitude()+.1)*o,l=r.normalise(),c=1;this.nodePoints.get(t.id).updateAcc(l.scalarMultip(s*c).divide(Math.pow(a,2))),this.nodePoints.get(n.id).updateAcc(l.scalarMultip(s*c).divide(-Math.pow(a,2)))}},this.updateHookesLaw=()=>{this.edges.forEach((t=>{const e=this.edgeSprings.get(t.id),i=e.target.p.subtract(e.source.p),n=e.length-i.magnitude(),o=i.normalise();e.source.updateAcc(o.scalarMultip(-this.props.stiffness*n)),e.target.updateAcc(o.scalarMultip(this.props.stiffness*n))}))},this.implementForce=(t,e,i=2)=>{const n=this.nodePoints.get(t.id),o=n.p.subtract(e);n.updateAcc(o.scalarMultip(-i))},this.attractToCentre=()=>{this.nodes.forEach((t=>{var e;const{degree:i,sDegree:n,tDegree:o}=null===(e=t.data)||void 0===e?void 0:e.layout,{leaf:s,single:r,others:a,center:l}=this.centripetalOptions,{width:c,height:d}=this.props;if(void 0===l)return;const{x:h,y:u,centerStrength:p}=l(t,this.nodes,this.edges,c,d);if(void 0===h||void 0===u)return;const g=new be(h,u);if(p)return void this.implementForce(t,g,p);const f="function"==typeof s?s(t,this.nodes,this.edges):s,y="function"==typeof r?r(t):r,m="function"==typeof a?a(t):a,v=0===o||0===n;0!==f&&0!==y&&0!==m&&(0===i?this.implementForce(t,g,y):v?this.implementForce(t,g,f):this.implementForce(t,g,m))}))},this.attractToSide=()=>{if(!this.props.defSideCoe||"function"!=typeof this.props.defSideCoe)return;const{height:t}=this.props;this.nodes.forEach((e=>{const i=this.props.defSideCoe(e);if(0===i)return;const n=this.nodePoints.get(e.id),{x:o}=n.p,s=new be(o,i>0?0:t);this.implementForce(e,s,Math.abs(i))}))},this.updateVelocity=t=>{this.nodes.forEach((e=>{const i=this.nodePoints.get(e.id);i.v=i.v.add(i.a.scalarMultip(t)).scalarMultip(this.props.damping),i.v.magnitude()>this.props.maxSpeed&&(i.v=i.v.normalise().scalarMultip(this.props.maxSpeed)),i.a=new be(0,0)}))},this.updatePosition=t=>{var e;if(!(null===(e=this.nodes)||void 0===e?void 0:e.length))return void(this.judgingDistance=0);const{distanceThresholdMode:i}=this.props;let n=0;"max"===i?this.judgingDistance=-1/0:"min"===i&&(this.judgingDistance=1/0),this.nodes.forEach((e=>{const o=this.nodePoints.get(e.id);o.p=o.p.add(o.v.scalarMultip(t));const s=o.v.scalarMultip(t).magnitude();switch(i){case"max":this.judgingDistance<s&&(this.judgingDistance=s);break;case"min":this.judgingDistance>s&&(this.judgingDistance=s);break;default:n+=s}})),i&&"mean"!==i||(this.judgingDistance=n/this.nodes.length)},this.addNode=t=>{const{ignore:e}=this.props;e&&e(t)||(t.id in this.nodeSet||this.nodes.push(t),this.nodeSet[t.id]=t)},this.addNodes=t=>{t.forEach((t=>{this.addNode(new ae(t))}))},this.addEdge=t=>(t.id in this.edgeSet||this.edges.push(t),this.edgeSet[t.id]=t,t),this.addEdges=t=>{try{const e=t.length;for(let i=0;i<e;i++){const e=t[i],n=e.source,o=e.target,s=this.nodeSet[n];if(void 0===s)throw new TypeError(`invalid node name: ${e.source}`);const r=this.nodeSet[o];if(void 0===r)throw new TypeError(`invalid node name: ${e.target}`);const a=e.data,l=new le(String(this.nextEdgeId++),s,r,a);this.addEdge(l)}}catch(t){console.error(t)}},this.register=(t,e)=>{this.registers.set(t,e)},this.restart=(t,e)=>{const{ignore:i}=this.props;e.getNodes().forEach((t=>{const e=t.get("model");if(i&&i(e))return;const n=new be(e.x,e.y),o=this.nodePoints.get(e.id);o&&(o.p=n,this.nodePoints.set(e.id,o))})),t.forEach((t=>{const e=new be(t.x,t.y),i=this.getMass(t);this.nodePoints.set(t.id,new xe(e,t.id,t.data,i)),this.edges.forEach((e=>{const i=this.nodePoints.get(e.source.id),n=this.nodePoints.get(e.target.id);if(i.id===t.id||n.id===t.id){const t=this.edgeSprings.get(e.id).length||100;this.edgeSprings.set(e.id,new Oe(i,n,t))}}))})),this.props.restartAnimation?this.animation():this.slienceForce()},this.stop=()=>{window.cancelAnimationFrame(this.timer),this.done=!0},this.getSameTypeLeafMap=()=>{const{nodeClusterBy:t}=this.props,e={};return this.nodes.forEach((i=>{var n;const{degree:o}=(null===(n=i.data)||void 0===n?void 0:n.layout)||{};1===o&&(e[i.id]=re.getCoreNodeAndRelativeLeafNodes("leaf",i,this.edges,t))})),e},this.props={stiffness:200,enableWorker:!1,defSpringLen:t=>t.data.spring||200,repulsion:1e3,centripetalOptions:{leaf:2,single:2},leafCluster:!1,clustering:!1,nodeClusterBy:"cluster",clusterNodeStrength:20,damping:.9,minEnergyThreshold:.1,maxSpeed:1e3,coulombDisScale:.005,tickInterval:.02,groupFactor:4,maxIterations:7440,minDistanceThreshold:.4,distanceThresholdMode:"mean",animation:!0,restartAnimation:!0,width:200,height:200},this.updateOptions(t),this.sourceData={nodes:[],edges:[],combos:[]},this.nodes=[],this.edges=[],this.nodeSet={},this.edgeSet={},this.renderNodes=[],this.nodePoints=new Map,this.edgeSprings=new Map,this.registers=new Map,this.done=!1,this.judgingDistance=0,this.iterations=0,this.nextEdgeId=0,this.timer=0,this.center=new be(0,0),this.centripetalOptions={leaf:2,single:2,others:1,center:t=>({x:this.props.width/2,y:this.props.height/2})},this.dragNodes=[]}};var je=function(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(i[n[o]]=t[n[o]])}return i},Se=function(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(i[n[o]]=t[n[o]])}return i};const Ee=(t,e,i)=>{if(e)try{t.forEach((t=>{const n=t.cfg.name;if(e[n]){const o=i(e,n),{animate:s,visible:r}=o,a=Se(o,["animate","visible"]);if(t.attrs.img)void 0!==a.opacity&&t.attr({opacity:a.opacity});else if(t.attr(a),t.cfg.visible=!1!==r,s){const{attrs:e}=s,i=Se(s,["attrs"]);t.animate(e,i)}}}))}catch(t){console.error(t)}};function _e(t){return Object.keys(t).forEach((e=>{void 0===t[e]&&delete t[e]})),t}const Ce=t=>{if(!t)return[0,0];let e=0,i=0;if(j(t))e=t,i=t;else if(x(t))if(1===t.length){const[n]=t;e=n,i=n}else if(2===t.length){const[n,o]=t;e=n,i=o}return[e,i]};var Ne=function(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(i[n[o]]=t[n[o]])}return i};function ke(t){let e;return j(t)?e=t/2:x(t)&&(e=t[0]/2),e}const Me=t=>{const{halo:e,keyshape:i}=t,{size:n,visible:o,fill:s,fillOpacity:r}=e,a=Ne(e,["size","visible","fill","fillOpacity"]),l=ke(n);let c,d,h;return i&&i.size&&(c=ke(i.size)+15),i&&i.fill&&(d=i.fill),i&&i.stroke&&(h=i.stroke),{name:"halo",visible:!1!==o,attrs:_e(Object.assign({x:0,y:0,r:l||c,fill:s||d||h,fillOpacity:r||.1,visible:!1!==o},a))}},Pe=t=>{const{keyshape:e}=t,{size:i,visible:n,stroke:o,fill:s,fillOpacity:r,strokeOpacity:a}=e,l=Ne(e,["size","visible","stroke","fill","fillOpacity","strokeOpacity"]),c=ke(i);return{name:"keyshape",visible:!1!==n,attrs:_e(Object.assign({x:0,y:0,r:c,cursor:"pointer",visible:!1!==n,stroke:o,strokeOpacity:a||1,fill:s||o,fillOpacity:r||.2},l))}},De=t=>{const{label:e}=t,{value:i,fill:n,fontSize:o,visible:s}=e,r=Ne(e,["value","fill","fontSize","visible"]),a=(t=>{const{label:e,keyshape:i}=t;if(!(null==i?void 0:i.size)&&!(null==e?void 0:e.offset))return{x:void 0,y:void 0,textBaseline:null==e?void 0:e.textBaseline};!(null==i?void 0:i.size)&&(null==e?void 0:e.offset)&&(i.size=26,console.info("you should set keyshape.size when you update label position,the default keyshape size value is  26"));const{size:n}=i;let o=[0,0];const{position:s,offset:r=o}=e;"number"!=typeof r&&"string"!=typeof r||(o=[Number(r),Number(r)]),r.length>0&&(o=r);const[a,l]=o;if("center"===s)return{x:0+a,y:0+l};const c=Ce(n),d=c[0],h=c[1];let u;switch(s){case"top":u={x:0+a,y:-h/2-l,textBaseline:"bottom"};break;case"bottom":default:u={x:0+a,y:h/2+l,textBaseline:"top"};break;case"left":u={x:0-d-a,y:0+l,textAlign:"right"};break;case"right":u={x:0+d+a,y:0+l,textAlign:"left"}}return u})(t);return{name:"label",visible:!1!==s,attrs:_e(Object.assign({x:a.x,y:a.y,fontSize:o,text:i,textAlign:"center",fill:n,textBaseline:a.textBaseline,visible:!1!==s},r))}},Le=t=>{const{icon:e}=t,{value:i="",type:n,fontFamily:o,textAlign:s="center",textBaseline:r="middle",fill:a,size:l,visible:c,clip:d}=e,h=Ne(e,["value","type","fontFamily","textAlign","textBaseline","fill","size","visible","clip"]),[u,p]=Ce(l),g={name:"icon",visible:!1!==c,capture:!1};return"text"===n||"font"===n?Object.assign(Object.assign({},g),{attrs:Object.assign({x:0,y:0,textAlign:s,textBaseline:r,text:i,fontSize:u,fontFamily:o,fill:a,visible:!1!==c},h)}):Object.assign(Object.assign({},g),{attrs:Object.assign({x:-u/2,y:-p/2,img:i,width:u,height:p,visible:!1!==c},h)})},Te=(t,e)=>"keyshape"===e?Pe(t).attrs:"halo"===e?Me(t).attrs:"label"===e?De(t).attrs:"icon"===e?Le(t).attrs:t[e]||{},Ae=(t,e,i)=>{const{type:n,position:o,value:s="",size:r,fill:a,stroke:l,color:c,fontSize:d,fontFamily:h,padding:u=0,offset:p=[0,0],id:g}=t,f=Ce(p),[y,m]=Ce(r),{x:v,y:b}=((t="RT",e)=>{let i=0,n=0;return"LT"===t?(i=e*Math.cos(3*Math.PI/4),n=-e*Math.sin(3*Math.PI/4)):"LB"===t?(i=e*Math.cos(5*Math.PI/4),n=-e*Math.sin(5*Math.PI/4)):"RT"===t?(i=e*Math.cos(1*Math.PI/4),n=-e*Math.sin(1*Math.PI/4)):"RB"===t&&(i=e*Math.cos(7*Math.PI/4),n=-e*Math.sin(7*Math.PI/4)),{x:i,y:n}})(o,i);let x=v,O=b;if(y===m){x+=f[0],O+=f[1];const t={attrs:{r:y/2+u,fill:a,stroke:l,x,y:O},name:"badges-circle"};g&&(t.id=g),e.addShape("circle",t)}else{x=v-y-2*u,O=b-m-2*u,"LB"===o?O=b:"RT"===o?(x=v,O=b-m-2*u):"RB"===o&&(x=v,O=b),x+=f[0],O+=f[1];const t={attrs:{width:y+2*u,height:m+2*u,fill:a,stroke:l,x,y:O,radius:(m+2*u)/3},name:"badges-rect"};g&&(t.id=g),e.addShape("rect",t)}"font"===n||"text"===n?e.addShape("text",{attrs:{x:y!==m?x+y/2+u:x,y:y!==m?O+m/2+u:O,text:s,fontSize:d,textAlign:"center",textBaseline:"middle",fontFamily:h,fill:c},capture:!1,name:"badges-text"}):"image"===n&&e.addShape("image",{attrs:{x:x-y/2,y:x-m/2,width:y,height:m,img:s},capture:!1,name:"badges-image"})};var Ie,$e=function(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(i[n[o]]=t[n[o]])}return i};function ze(t){return Object.keys(t).forEach((e=>{void 0===t[e]&&delete t[e]})),t}!function(t){t.NORMAL="normal",t.SELECTED="selected",t.HOVERED="hovered",t.DISABLED="disabled"}(Ie||(Ie={}));const Fe=(t,e)=>"keyshape"===e?function(t){const e=$e(t,[]);return ze(Object.assign({id:"keyshape"},e))}(t.keyshape||{}):"halo"===e?function(t){const e=$e(t,[]);return ze(Object.assign({id:"halo"},e))}(t.halo||{}):"label"===e?function(t){const{value:e}=t,i=$e(t,["value"]);return ze(Object.assign({id:"label",text:e},i))}(t.label||{}):{},Be=(t,e,i)=>{const n=(e.x+t.x)/2,o=(e.y+t.y)/2,s=e.x-t.x,r=e.y-t.y,a=Math.sqrt(Math.pow(s,2)+Math.pow(r,2));return{x:n+r*i/a||0,y:o-s*i/a||0}};I().registerLayout("graphin-force",{getDefaultCfg:()=>({preset:{name:"grid",options:{}},stiffness:200,repulsion:1e3,centripetalOptions:{leaf:1.6,single:1.6},damping:.9,minEnergyThreshold:.1,maxSpeed:1e3,MaxIterations:1e4,animation:!0}),init(t){this.nodes=t.nodes,this.edges=t.edges;const{graph:e}=this,i=je(this,["graph"]),n=Object.assign(Object.assign({},this.getDefaultCfg()),i),{width:o,height:s,animation:r,done:a=(()=>{})}=n,l=je(n,["width","height","animation","done"]);this.simulation=new we(Object.assign(Object.assign(Object.assign({width:o,height:s,animation:r},l),i),{done:t=>{a(e,t)}})),this.simulation.setData(t),this.simulation.register("render",(i=>{if(!r&&t&&t.nodes&&t.nodes.length>0){const{nodes:e}=i;return t.nodes.forEach(((t,i)=>{const n=e[i];if(n&&n.id===t.id)t.x=e[i].x,t.y=e[i].y;else{const i=e.find((e=>e.id===t.id));i&&(t.x=i.x,t.y=i.y)}})),Object.assign({},i)}try{if(!e||e.destroyed)return;let t=!1;i.nodes.forEach((i=>{const n=e.findById(i.id);if(n){const e=n.get("model");e.x=i.x,e.y=i.y,"combo"===n.getType()&&(t=!0)}})),e.refreshPositions(t)}catch(t){console.error(t)}}))},execute(){this.simulation.start()},layout(t){this.init(t),this.execute()},updateCfg(t){this.cfg=Object.assign(Object.assign({},this.cfg),t)},destroy(){this.destroyed=!0,this.simulation.stop(),this.simulation=null},getType:()=>"graphin-force"}),I().registerLayout("preset",{init(){},execute(){},destroy(){this.destroyed=!0}}),I().registerNode("graphin-circle",{options:{style:{},status:{}},draw(t,e){const{_theme:i}=t.style;this.options=((t={})=>{const e=Wt(t),{defaultNodeStyle:i,defaultNodeStatusStyle:n}=e;return{style:i.style,status:n.status}})(i);const n=C({},this.options.style,t.style);t._initialStyle=Object.assign({},n);const{icon:o,badges:s=[],keyshape:r}=n,a=ke(r.size);e.addShape("circle",Me(n));const l=e.addShape("circle",Pe(n));e.addShape("text",De(n));const{type:c}=o;if("text"!==c&&"font"!==c||e.addShape("text",Le(n)),"image"===c){const t=Le(n),i=e.addShape("image",t),{clip:o}=n.icon;if(o){const{r:t}=o,e=Ne(o,["r"]);i.setClip({type:"circle",attrs:Object.assign({x:0,y:0,r:t},e)})}}return s.forEach((t=>{Ae(t,e,a)})),l},setState(t,e,i){var n;if(!t)return;const o=i.getModel(),s=i.getContainer().get("children"),r=C({},this.options.status,o.style.status),a=i.getModel()._initialStyle,l=(null===(n=i._cfg)||void 0===n?void 0:n.states)||[];try{Object.keys(r).forEach((i=>{t===i&&(e?Ee(s,r[i],Te):(Ee(s,a,Te),l.forEach((t=>{Ee(s,r[t],Te)}))))}))}catch(t){console.error(t)}},update(t,e){if(t.style)try{const i=C({},t._initialStyle,t.style);t._initialStyle=Object.assign({},i);const{badges:n,keyshape:o}=i,s=ke(o.size),r=e.getContainer(),a=r.get("children");Ee(a,i,Te);const l=[...a];if(n){let t=0;l.forEach((e=>{e.cfg.name.startsWith("badges")?a.splice(t,1):t+=1})),n.forEach((t=>{Ae(t,r,s)}))}}catch(t){console.error("error")}}}),I().registerEdge("graphin-line",{draw(t,e){var i,n,o,s,r,a,l;const{_theme:c}=t.style;this.options=((t={})=>{const e=Wt(t),{defaultEdgeStyle:i,defaultEdgeStatusStyle:n}=e;return{style:i.style,status:n.status}})(c);const d=C({},this.options.style,t.style);t&&(t._initialStyle=Object.assign({},d));const{startPoint:h={x:0,y:0},endPoint:u={x:0,y:0},sourceNode:p,targetNode:g}=t,{label:f,halo:y,keyshape:m}=d,v=p.get("model"),b=(null===(i=g)||void 0===i?void 0:i.get("model"))||{id:"temp"},x=(null===(o=null===(n=v.style)||void 0===n?void 0:n.keyshape)||void 0===o?void 0:o.size)||28,O="loop"===(null==m?void 0:m.type)||v.id===b.id,w=f.value,j="poly"===(null==m?void 0:m.type),S=Be(h,u,(null===(s=null==m?void 0:m.poly)||void 0===s?void 0:s.distance)||0),E=(null==m?void 0:m.lineWidth)||1,_=E+5,N=((t,e)=>{var i,n,o;const{startPoint:s={x:0,y:0},endPoint:r={x:0,y:0},sourceNode:a,targetNode:l}=t,{keyshape:c}=e,{type:d="line",poly:h={distance:0},loop:u={}}=c,p=a.get("model"),g=(null===(i=l)||void 0===i?void 0:i.get("model"))||{id:"temp"};if("loop"===d||p.id===g.id){const t=(null===(o=null===(n=p.style)||void 0===n?void 0:n.keyshape)||void 0===o?void 0:o.size)||26,{distance:e,dx:i,rx:r,ry:a}=Object.assign({distance:0,dx:8,rx:void 0,ry:void 0},u),l=t/2,c=Math.sqrt(Math.max(Math.pow(l,2)-Math.pow(i,2),0)),d=r||2*l*.5,h=a||2*l*.6;return[["M",s.x-i,s.y-c],["A",d+e,h+e,0,1,1,s.x+i,s.y-c]]}if("poly"===d){const t=Be(s,r,(null==h?void 0:h.distance)||0);return[["M",s.x,s.y],["Q",t.x,t.y,r.x,r.y]]}return[["M",s.x,s.y],["L",r.x,r.y]]})(t,d);e.addShape("path",{attrs:Object.assign({id:"halo",path:N,lineWidth:E+10,stroke:y.stroke||m.stroke,strokeOpacity:y.strokeOpacity||.4},y),draggable:!0,name:"halo",visible:!1!==y.visible});const k=e.addShape("path",{attrs:Object.assign({id:"keyshape",path:N,endArrow:O?void 0:{d:0,path:`M 0,0 L ${_},${_/2} L ${_},-${_/2} Z`,fill:m.stroke},startArrow:O?{d:0,path:`M 0,0 L ${_},${_/2} L ${_},-${_/2} Z`,fill:m.stroke}:void 0},m),draggable:!0,name:"keyshape"});if(w){const{value:t,fontSize:i=8,offset:n=[0,0],background:o}=f,s=$e(f,["value","fontSize","offset","background"]),c=Boolean(o),[d,p]=n;let g=Math.atan((u.y-h.y)/(u.x-h.x)),y=[(h.x+u.x)/2,(h.y+u.y)/2];if(j&&(y=[(S.x+y[0])/2,(S.y+y[1])/2]),u.x-h.x==0&&(g=Math.PI/2),O&&(g=2*Math.PI),c){const n={fill:"#fff",width:X(t)*i*.6,height:1.8*i,stroke:m.stroke,lineWidth:1,radius:6},s=Object.assign(Object.assign({},n),o),{fill:a,width:l,height:c,stroke:h}=s,u=$e(s,["fill","width","height","stroke"]);let f=-c/2+p;O&&(f=-(c/2+p+i+1*x+2*((null===(r=null==m?void 0:m.loop)||void 0===r?void 0:r.distance)||0)));const v=e.addShape("rect",{attrs:Object.assign({id:"label-background",x:-l/2+d,y:f,width:l,height:c,fill:a,stroke:h},u),draggable:!0,name:"label-background"});v.rotate(g),v.translate(y[0],y[1])}let v=p-i/2;c&&(v=p+i/2),O&&(v=c?-(p+i/2+1*x+2*((null===(a=null==m?void 0:m.loop)||void 0===a?void 0:a.distance)||0)):-(p+i+1*x+2*((null===(l=null==m?void 0:m.loop)||void 0===l?void 0:l.distance)||0)));const b=e.addShape("text",{attrs:Object.assign({id:"label",x:d,y:v,text:t,fontSize:i},s),draggable:!0,name:"label"});b.rotate(g),b.translate(y[0],y[1])}return k},setState(t,e,i){var n;if(!t)return;const o=i.getModel(),s=i.getContainer().get("children"),r=C({},this.options.status,o.style.status),a=i.getModel()._initialStyle,l=(null===(n=i._cfg)||void 0===n?void 0:n.states)||[];try{Object.keys(r).forEach((i=>{t===i&&(e?Ee(s,r[i],Fe):(Ee(s,a,Fe),l.forEach((t=>{Ee(s,r[t],Fe)}))))}))}catch(t){console.error(t)}},afterDraw(t,e){const i=C({},this.options.style,t.style),{animate:n,keyshape:o}=i;if(!n||!n.type||!1===n.visible)return;const s=e.get("children").find((t=>"keyshape"===t.get("name"))),{color:r,type:a,repeat:l=!0,duration:c=3e3}=n;if("circle-running"===a){const t=s.getPoint(0);e.addShape("circle",{attrs:{x:t.x,y:t.y,fill:r||o.stroke,r:1.5*o.lineWidth+2},name:"circle-shape"}).animate((t=>{const e=s.getPoint(t);return{x:e.x,y:e.y}}),{repeat:l,duration:c})}if("line-dash"===a){let t=0;const e=n.lineDash||o.lineDash||[4,2,1,2];s.animate((()=>(t++,t>9&&(t=0),{lineDash:e,lineDashOffset:-t})),{repeat:l,duration:c})}if("line-growth"===a){const t=s.getTotalLength();s.animate((e=>{const i=e*t;return{lineDash:[i,t-i]}}),{repeat:l,duration:c})}}});const{registerFontFamily:Re}=ie,We=ie})(),s})()}));